<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/jsf-template/listViewTemplate.xhtml">

    <ui:define name="contentLabel"><h:outputText value="Доноры"/></ui:define>

    <ui:define name="contentButtonsPanel">
        <p:toolbarGroup align="left">
            <p:button value="Новый донор" outcome="/component/donor.xhtml" target="_blank" icon="ui-icon-plusthick">
                <f:param name="docAction" value="create"/>
            </p:button>
            <p:commandButton value="Обновить" update="documentTable" icon="ui-icon-refresh" ajax="true"/>
            <p:menuButton value="Печать" id="printButton">
                <p:menuitem value="Печать из браузера" url="/component/print/donors.xhtml" target="_blank"/>
                <p:menuitem value="Экспорт в Excel всех страниц" ajax="false">
                    <p:dataExporter type="xlsx" target="documentTable" fileName="donors"/>
                </p:menuitem>
                <p:menuitem value="Экспорт в Excel текущей страницы" ajax="false">
                    <p:dataExporter type="xlsx" target="documentTable" fileName="donors" pageOnly="true"/>
                </p:menuitem>
            </p:menuButton>
        </p:toolbarGroup>
    </ui:define>

    <ui:define name="contentTable">
        <div class="ui-q ui-g-nopad" style="height:100%">
            <div class="ui-g-3 ui-g-nopad" style="height:100%">
                <p:panelGrid style="width:100%">
                    <p:row>
                        <p:column>
                            <p:outputLabel for="number" value="Номер:"/>
                        </p:column>
                        <p:column>
                            <p:inputMask id="number" value="#{donorFilterableList.filter['NUMBER']}" mask="99999"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel for="startCreationDate" value="Дата создания от:"/>
                        </p:column>
                        <p:column>
                            <p:calendar id="startCreationDate" value="#{donorFilterableList.filter['START_CREATE_DATE']}"
                                        lang="ru" locale="ru" pattern="dd.MM.yyyy" showOn="both"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel for="endCreationDate" value="Дата создания до:"/>
                        </p:column>
                        <p:column>
                            <p:calendar id="endCreationDate" value="#{donorFilterableList.filter['END_CREATION_DATE']}"
                                        lang="ru" locale="ru" pattern="dd.MM.yyyy" showOn="both"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel for="lastName" value="Фамилия:"/>
                        </p:column>
                        <p:column>
                            <p:inputText id="lastName" value="#{donorFilterableList.filter['LAST_NAME']}"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel for="firstName" value="Имя:"/>
                        </p:column>
                        <p:column>
                            <p:inputText id="firstName" value="#{donorFilterableList.filter['FIRST_NAME']}"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel for="patrName" value="Отчество:"/>
                        </p:column>
                        <p:column>
                            <p:inputText id="patrName" value="#{donorFilterableList.filter['PATR_NAME']}"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel for="birthDate" value="Дата рождения:"/>
                        </p:column>
                        <p:column>
                            <p:calendar id="birthDate" value="#{donorFilterableList.filter['BIRTH_DATE']}"
                                        lang="ru" locale="ru" pattern="dd.MM.yyyy" showOn="both"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel for="sex" value="Пол:"/>
                        </p:column>
                        <p:column>
                            <p:selectOneButton id="sex" value="#{donorFilterableList.filter['SEX']}">
                                <f:selectItem itemLabel="М" itemValue="MALE" />
                                <f:selectItem itemLabel="Ж" itemValue="FEMALE" />
                                <f:selectItem itemLabel="Любой" itemValue="ALL" />
                            </p:selectOneButton>

                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <p:outputLabel for="bloodGroup" value="Группа крови:"/>
                        </p:column>
                        <p:column>
                          <p:selectOneMenu

                        </p:column>
                    </p:row>
                </p:panelGrid>
            </div>
            <div class="ui-g-9 ui-g-nopad" style="height:100%">
                <p:dataTable id="documentTable"
                             paginator="true"
                             rows="100"
                             currentPageReportTemplate="#{props['CURRENT_PAGE_PAGINATOR_TEMPLATE']}"
                             paginatorTemplate="#{props['PAGINATOR_TEMPLATE']}"
                             rowsPerPageTemplate="#{props['ROWS_PER_PAGE_DROPDOWN']}"
                             paginatorPosition="#{props['PAGINATOR_POSITION']}"
                             emptyMessage="#{props['EMPTY_RESULT']}"
                             value="#{donorFilterableList}"
                             var="row"
                             lazy="true"
                             widgetVar="documentTableWidget"
                             scrollable="true" scrollHeight="100%"
                             selectionMode="single"
                             sortBy="#{row.lastName}" sortField="lastName" sortOrder="ascending"
                             resizableColumns="true" liveResize="true"
                        >
                    <p:column headerText="Фамилия" style="width:8.5em;" sortBy="#{row.lastName}" field="lastName">
                        <h:outputText value="#{row.lastName}"/>
                    </p:column>
                    <p:column headerText="Имя" style="width:6em;" sortBy="#{row.firstName}" field="firstName">
                        <h:outputText value="#{row.firstName}"/>
                    </p:column>
                    <p:column headerText="Отчество" style="width:9em;" sortBy="#{row.patrName}" field="patrName">
                        <h:outputText value="#{row.middleName}"/>
                    </p:column>
                    <p:column headerText="Номер" style="width:4em; text-align: right;" sortBy="#{row.number}" field="number">
                        <h:outputText value="#{row.number}"/>
                    </p:column>
                    <p:column headerText="Категория" style="width:6em;" sortBy="#{row.category}" field="category" priority="6">
                        <h:outputText value="#{row.category}" converter="DonorCategoryConverter"/>
                    </p:column>
                    <p:column headerText="Группа крови" style="width:8em; text-align: right;" sortBy="#{row.bloodGroup.value}"
                              field="bloodGroup.value">
                        <h:outputText value="#{row.bloodGroup.value}"/>
                    </p:column>
                    <p:column headerText="Резус-Фактор" style="width:8em;" sortBy="#{row.rhesusFactor}" field="rhesusFactor">
                        <h:outputText value="#{row.rhesusFactor}"/>
                    </p:column>
                    <p:column headerText="Статус" style="width:10em;" sortBy="#{row.statusName}" field="statusName">
                        <h:outputText value="#{row.statusName}"/>
                    </p:column>
                    <p:column headerText="Комментарий" priority="6">
                        <h:outputText value="#{row.commentary}"/>
                    </p:column>
                    <p:ajax event="rowSelect" onstart="goToDonor(PrimeFaces.widgets.documentTableWidget.selection); return false;"/>
                </p:dataTable>
            </div>
        </div>
    </ui:define>
</ui:composition>

</html>
