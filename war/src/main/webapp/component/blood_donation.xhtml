<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:e5ui="http://efive.ru/uitemplates"
      xmlns:e5ui-comp="http://efive.ru/uitemplates/composite">

<ui:composition template="#{sessionManagement.templateName}">

    <ui:define name="running_head">
        <!-- #{bloodDonation.document.id}  -->
        <e5ui-comp:userSessionUpdate interval="300"/>
        <h:outputScript library="js" name="datepicker_init_ru.js" target="head"/>
        <h:outputScript name="jsf.js" library="javax.faces" target="head"/>
        <h:outputScript library="js" name="forms.js" target="head"/>
        <e5ui-comp:outputUtilScript/>
        <h:outputScript>
            var isVisibleHistory = false;

            function changeVisibleHistory() {
            isVisibleHistory=!isVisibleHistory;
            hideShowHistory();
            }

            function hideShowHistory() {
            var blockHistory = $("[id*='history']");
            if (isVisibleHistory) {
            blockHistory.show();
            } else {
            blockHistory.hide();
            }
            }

            function setCursor(typeCursor) {
            var styleTitle = "cursor: " + typeCursor + ";color: #4581c0";
            $("[id*='history']").prev().find("a").attr("style", styleTitle);
            }

            jQuery(function(){
            hideShowHistory();
            headContent = $("[id='header_content']").find("div:first");
            if (headContent.text() == '404 - Донация не найдена') {
            $("[id='form_header']").hide();
            headContent.html('<div class="name">Обращение отменено</div><button onclick="window.close()">Закрыть форму</button>');
            }
            });
        </h:outputScript>
    </ui:define>

    <ui:define name="left_menu"/>

    <ui:define name="header">
        <div id="form_header">
            <div class="actionbar">
                <div class="menu">
                    <div class="defbutton">
                        <h:commandLink action="#{bloodDonation.edit}" rendered="#{bloodDonation.viewState}">
                            <h:graphicImage value="#{resource['images:edit_buttn.png']}"/>
                            Редактировать
                        </h:commandLink>
                    </div>
                    <div class="defbutton">
                        <h:commandLink action="#{bloodDonation.cancel}"
                                       rendered="#{bloodDonation.editState or bloodDonation.createState}">
                            <h:graphicImage value="#{resource['images:button-cancel.png']}"/>
                            Отменить
                        </h:commandLink>
                    </div>
                    <div class="defbutton">
                        <h:commandLink action="#{bloodDonation.save}"
                                       rendered="#{bloodDonation.editState or bloodDonation.createState}">
                            <h:graphicImage value="#{resource['images:save_buttn.png']}"/>
                            Сохранить
                        </h:commandLink>
                    </div>
                    <div class="defbutton">
                        <e5ui:formPart id="actions_fp">
                            <h:panelGroup rendered="#{bloodDonation.document.statusId ne -2}">
                                <h:commandLink onclick="actionsModal.clickOpen('actionsModal'); return false;">
                                    <h:graphicImage value="#{resource['images:button-do.png']}"/>
                                    Действия
                                </h:commandLink>
                            </h:panelGroup>
                            <e5ui-comp:modalWindow id="actionsModal"
                                                   modalWindowHolder="#{bloodDonation.processorModal}"
                                                   render=":main_content_form" execute="selectedAction"
                                                   showButtons="false"
                                                   widgetVar="actionsModal">
                                <h:panelGroup rendered="#{not(bloodDonation.processorModal.processingState)}">
                                    <div id="title">Действия</div>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{bloodDonation.processorModal.actionsAvailable}">
                                    <div class="wrap" style="height:90px;background-color:#fff;clear:both;">
                                        <div class="inner" style="height: 90px;">
                                            <e5ui:dataTable id="action_select_table" border="0"
                                                            cellpadding="0" cellspacing="0"
                                                            value="#{bloodDonation.processorModal.availableActions}"
                                                            var="row"
                                                            grouping="false" width="100%">
                                                <e5ui:row onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                          styleClass="#{bloodDonation.processorModal.selected(row)? 'grid_row_selected': ''}"/>
                                                <e5ui:column>
                                                    <f:facet name="header">
                                                        <p>Доступные действия</p>
                                                    </f:facet>
                                                    <h:outputText value="#{row.name}"/>
                                                    <h:commandLink id="selectLink" style="display: none;"
                                                                   rendered="#{not bloodDonation.processorModal.selected(row)}"
                                                                   action="#{bloodDonation.processorModal.select(row)}"/>
                                                </e5ui:column>
                                            </e5ui:dataTable>
                                        </div>
                                    </div>
                                </h:panelGroup>
                                <h:panelGroup
                                        rendered="#{bloodDonation.processorModal.noActionsAvailable or bloodDonation.processorModal.failureState or bloodDonation.processorModal.processedState}">
                                    <div style="padding-left: 10px;">
                                        <ui:repeat value="#{bloodDonation.processorModal.actionResult.split(':')}"
                                                   var="element">
                                            <h:outputText value="#{element}"/>
                                            <br/>
                                        </ui:repeat>
                                    </div>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{bloodDonation.processorModal.processingState}">
                                    <e5ui:include
                                            data="#{bloodDonation.processorModal.processedActivity.document.form}"/>
                                </h:panelGroup>

                                <div class="e5ui-modal-bottombuttons">
                                    <h:commandButton action="#{bloodDonation.processorModal.process()}"
                                                     rendered="#{bloodDonation.processorModal.actionsAvailable or bloodDonation.processorModal.processingState}"
                                                     value="Выполнить"/>
                                    <h:button
                                            rendered="#{bloodDonation.processorModal.actionsAvailable or bloodDonation.processorModal.processingState}"
                                            onclick="actionsModal.clickClose(); return false;"
                                            value="Отмена"/>
                                    <h:button
                                            rendered="#{bloodDonation.processorModal.noActionsAvailable or bloodDonation.processorModal.failureState or bloodDonation.processorModal.processedState}"
                                            onclick="actionsModal.clickClose(); return false;"
                                            value="Закрыть"/>
                                </div>
                            </e5ui-comp:modalWindow>
                        </e5ui:formPart>
                    </div>
                    <div class="top">
                        <h:commandLink styleClass="top_link" onclick="return false;">
        <span>
            <h:graphicImage value="#{resource['images:button-print.png']}"/>
            Печать направлений
        </span>
                        </h:commandLink>

                        <div class="sub">
                            <div class="item">
                                <h:outputLink value="/component/print/appointment_card_all2.xhtml"
                                              target="_blank">
                                    <h:graphicImage value="#{resource['images:blank.png']}"/>
                                    <f:param name="docId" value="#{bloodDonation.document.id}"/>
                                    Направления на исследование
                                </h:outputLink>
                            </div>
                            <div class="item">
                                <h:outputLink value="/component/print/donation_appointment2.xhtml"
                                              target="_blank">
                                    <h:graphicImage value="#{resource['images:blank.png']}"/>
                                    <f:param name="docId" value="#{bloodDonation.document.id}"/>
                                    Кроводача, осмотр врача
                                </h:outputLink>
                            </div>
                            <h:panelGroup rendered="#{not (bloodDonation.document.report eq null)}">
                                <div class="item">
                                    <h:outputLink value="/component/print/citaferez.xhtml"
                                                  target="_blank">
                                        <h:graphicImage value="#{resource['images:blank.png']}"/>
                                        <f:param name="docId" value="#{bloodDonation.document.id}"/>
                                        Протокол цитафереза
                                    </h:outputLink>
                                </div>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{bloodDonation.editState or bloodDonation.viewState}">
                                <div class="item">
                                    <h:outputLink
                                            value="/component/print/blood_donation_information2.xhtml"
                                            target="_blank">
                                        <h:graphicImage value="#{resource['images:blank.png']}"/>
                                        <f:param name="docId" value="#{bloodDonation.document.id}"/>
                                        Справка о кроводаче
                                    </h:outputLink>
                                </div>
                                <div class="item">
                                    <h:outputLink
                                            value="/component/print/external_appointment_card2.xhtml"
                                            target="_blank">
                                        <h:graphicImage value="#{resource['images:blank.png']}"/>
                                        <f:param name="docId" value="#{bloodDonation.document.id}"/>
                                        Направление в поликлинику
                                    </h:outputLink>
                                </div>
                                <div class="item">
                                    <h:outputLink value="/component/print/donor405_2.xhtml"
                                                  target="_blank">
                                        <h:graphicImage value="#{resource['images:blank.png']}"/>
                                        <f:param name="docId" value="#{bloodDonation.document.id}"/>
                                        Форма 405У
                                    </h:outputLink>
                                </div>
                                <div class="item">
                                    <h:outputLink value="/component/print/information2.xhtml"
                                                  target="_blank">
                                        <h:graphicImage value="#{resource['images:blank.png']}"/>
                                        <f:param name="docId" value="#{bloodDonation.document.id}"/>
                                        Справка об обследовании
                                    </h:outputLink>
                                </div>
                            </h:panelGroup>
                        </div>
                    </div>
                    <h:panelGroup
                            rendered="#{(bloodDonation.editState or bloodDonation.createState) and (bloodDonation.document.examination eq null)}">
                        <div class="defbutton">
                            <h:commandLink
                                    onclick="parentExaminationSelect.clickOpen('parentExaminationSelect'); return false;">
                                <h:graphicImage value="#{resource['images:button-do.png']}"/>
                                Выбрать донора/обследование
                            </h:commandLink>
                            <e5ui-comp:modalWindow id="parentExaminationSelect"
                                                   modalWindowHolder="#{bloodDonation.parentExaminationSelect}"
                                                   style="width:400px;"
                                                   render=":main_content_form" execute="examination_select_table"
                                                   showButtons="false"
                                                   widgetVar="parentExaminationSelect">
                                <div id="title">Выбор обращения на обследование</div>
                                <div id="examination_list" style="margin-top:0;">
                                    <div class="searchbar">
                                        <div style="float:right; margin-right:5px;">
                                            <h:outputLabel for="filter_string_last_name"
                                                           style="float:left; margin-right:5px;">Фамилия</h:outputLabel>
                                            <h:inputText id="filter_string_last_name"
                                                         value="#{bloodDonation.parentExaminationSelect.examinationList.filterDonorLastName}"
                                                         style="display:block;" title="Поиск по фамилии"/>
                                        </div>
                                        <div style="float:right; margin-right:5px;">
                                            <h:outputLabel for="filter_string_first_name"
                                                           style="float:left; margin-right:5px;">Имя</h:outputLabel>
                                            <h:inputText id="filter_string_first_name"
                                                         value="#{bloodDonation.parentExaminationSelect.examinationList.filterDonorFirstName}"
                                                         style="display:block;" title="Поиск по имени"/>
                                        </div>
                                        <div style="float:right; margin-right:5px;">
                                            <h:outputLabel for="filter_string_middle_name"
                                                           style="float:left; margin-right:5px;">Отчество</h:outputLabel>
                                            <h:inputText id="filter_string_middle_name"
                                                         value="#{bloodDonation.parentExaminationSelect.examinationList.filterDonorMiddleName}"
                                                         style="display:block;" title="Поиск по отчеству"/>
                                        </div>
                                        <div style="float:right; margin-right:5px;">
                                            <h:outputLabel for="filter_string_number_examination"
                                                           style="float:left; margin-right:5px;">Номер обследования</h:outputLabel>
                                            <h:inputText id="filter_string_number_examination"
                                                         value="#{bloodDonation.parentExaminationSelect.examinationList.filterNumberExamination}"
                                                         style="display:block;" title="Поиск по номеру"/>
                                        </div>
                                        <div style="float:right; margin-right:5px;">
                                            <h:commandButton value=" "
                                                             action="#{bloodDonation.parentExaminationSelect.examinationList.changePageOffset(0)}"
                                                             styleClass="searchbutton">
                                                <f:ajax execute=":main_content_form:parentExaminationSelect:filter_string_number_examination
                        :main_content_form:parentExaminationSelect:filter_string_last_name 
                        :main_content_form:parentExaminationSelect:filter_string_first_name 
                        :main_content_form:parentExaminationSelect:filter_string_middle_name"
                                                        render=":main_content_form:parentExaminationSelect:examination_select_table :main_content_form:parentExaminationSelect:examination_paging"/>
                                            </h:commandButton>
                                        </div>
                                    </div>
                                    <div class="wrap" style="height:300px; background-color:#fff; clear:both;">
                                        <div class="inner" style="height:300px;">
                                            <e5ui:dataTable id="examination_select_table" border="0" cellpadding="0"
                                                            cellspacing="0"
                                                            value="#{bloodDonation.parentExaminationSelect.examinationList.documents}"
                                                            var="row" grouping="false" width="100%">
                                                <e5ui:row onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                          styleClass="#{bloodDonation.parentExaminationSelect.selected(row)? 'grid_row_selected': ''}"/>
                                                <e5ui:column style="min-width:5em">
                                                    <f:facet name="header">
                                                        <p>Номер обследования</p>
                                                    </f:facet>
                                                    <h:outputText value="#{row.number}"/>
                                                    <h:commandLink id="selectLink" style="display: none;"
                                                                   rendered="#{not bloodDonation.parentExaminationSelect.selected(row)}"
                                                                   action="#{bloodDonation.parentExaminationSelect.select(row)}"/>
                                                </e5ui:column>
                                                <e5ui:column style="min-width:10em">
                                                    <f:facet name="header">
                                                        <p style="margin-left: 70px">Донор</p>
                                                    </f:facet>
                                                    <h:outputText value="#{row.donor.descriptionShort}"/>
                                                </e5ui:column>
                                                <e5ui:column style="min-width:9em">
                                                    <f:facet name="header">
                                                        <p>Обследование</p>
                                                    </f:facet>
                                                    <h:outputText
                                                            value="#{row.examinationType eq 0? 'Первичное': 'Повторное'}"/>
                                                </e5ui:column>
                                            </e5ui:dataTable>
                                        </div>
                                    </div>
                                    <div style="clear:both;">
                                        <h:panelGroup id="examination_paging">
                                            <e5ui-comp:tablePager
                                                    documentListHolder="#{bloodDonation.parentExaminationSelect.examinationList}"/>
                                        </h:panelGroup>
                                    </div>
                                </div>
                                <div class="e5ui-modal-bottombuttons">
                                    <h:button onclick="parentExaminationSelect.clickSave(); return false;"
                                              value="Выбрать"/>
                                    <h:button onclick="parentExaminationSelect.clickClose(); return false;"
                                              value="Отмена"/>
                                </div>
                            </e5ui-comp:modalWindow>
                        </div>
                    </h:panelGroup>
                </div>
            </div>
        </div>
    </ui:define>

    <ui:define name="content">
        <div id="header_content">
            <h:panelGroup rendered="#{bloodDonation.createState}">
                <div class="name">Новая донация</div>
                <div class="title">
                    <h:outputText value="#{bloodDonation.document.statusName}"/>
                </div>
            </h:panelGroup>
            <h:panelGroup rendered="#{bloodDonation.editState or bloodDonation.viewState}">
                <div class="name">
                    <div>
                        <span>Донация</span>
                        <h:outputText style="margin:0 5px;" value="#{bloodDonation.document.number}"/>
                        <span>от</span>
                        <h:outputText style="margin:0 5px;" value="#{bloodDonation.document.created}">
                            <f:convertDateTime type="date" pattern="dd.MM.yyyy"/>
                        </h:outputText>
                    </div>
                </div>
                <div class="title" style="float:none;">
                    <div>
                        <h:outputText value="#{bloodDonation.document.statusName}"/>
                    </div>
                    <h:panelGroup rendered="#{bloodDonation.document.statusId lt 0}">
                        <div>
                            <h:outputText value="#{bloodDonation.document.rejection.rejectionType.value}"/>
                        </div>
                    </h:panelGroup>
                </div>
            </h:panelGroup>
            <h:panelGroup rendered="#{bloodDonation.notFoundState}">
                <div class="name">404 - Донация не найдена</div>
            </h:panelGroup>
            <h:panelGroup rendered="#{bloodDonation.forbiddenState}">
                <div class="name">403 - Действие запрещено</div>
            </h:panelGroup>
            <h:panelGroup
                    rendered="#{not(bloodDonation.createState or bloodDonation.editState or bloodDonation.viewState or bloodDonation.notFoundState or bloodDonation.forbiddenState)}">
                <div class="name">В доступе отказано</div>
            </h:panelGroup>
        </div>

        <div class="main_content">
            <div class="#{bloodDonation.document.statusId eq 1? '': 'tileleft'}">
                <div>
                    <fieldset>
                        <legend>
                            <label>
                                <span class="title">Общая информация</span>
                            </label>
                        </legend>
                        <h:panelGroup rendered="#{bloodDonation.viewState}">
                            <div class="row">
                                <table class="form_grid">
                                    <tr class="row">
                                        <td class="first">Донор:</td>
                                        <td>
                                            <h:outputText value="#{bloodDonation.document.donor.description}"
                                                          style="font-weight:bold;"
                                                          class="wide"/>
                                            <h:outputLink rendered="#{bloodDonation.document.donor ne null}"
                                                          style="margin-left:5px;"
                                                          value="/component/donor.xhtml" target="_blank">
                                                <h:graphicImage value="#{resource['images:link.png']}"/>
                                                <f:param name="docId" value="#{bloodDonation.document.donor.id}"/>
                                            </h:outputLink>
                                        </td>
                                    </tr>
                                    <tr class="row">
                                        <td class="first">Тип донора:</td>
                                        <td>
                                            <h:outputText value="#{bloodDonation.document.donorType}" class="wide"
                                                          converter="ClassifierConverter"/>
                                        </td>
                                    </tr>
                                    <h:panelGroup
                                            rendered="#{not ((bloodDonation.document.statusId eq 2) and (sessionManagement.operational))}">
                                        <tr class="row">
                                            <td class="first">Дата/время регистрации:</td>
                                            <td>
                                                <h:outputText value="#{bloodDonation.document.created}" class="wide">
                                                    <f:convertDateTime type="date" pattern="dd.MM.yyyy HH:mm"/>
                                                </h:outputText>
                                            </td>
                                        </tr>
                                        <tr class="row">
                                            <td class="first">Первичный осмотр:</td>
                                            <td>
                                                <h:panelGroup rendered="#{bloodDonation.document.examination ne null}">
                                                    <h:outputLink value="/component/examination.xhtml" target="_blank">
                                                        <f:param name="docId" value="#{bloodDonation.document.examination.id}"/>
                                                        <h:outputText value="#{bloodDonation.document.examination.examinationType eq 0? 'Первичное': 'Повторное'} обследование #{bloodDonation.document.examination.number} "/>
                                                    </h:outputLink>
                                                </h:panelGroup>
                                                <h:outputText value="#{bloodDonation.document.therapist.description}"
                                                              class="wide"/>
                                            </td>
                                        </tr>
                                        <tr class="row">
                                            <td class="first" colspan="2">
                                                <fieldset>
                                                    <legend>
                                                        <label><span class="title">Системы крови</span> </label>
                                                    </legend>
                                                    <div class="wrap" style="width:100%; margin:0">
                                                        <div class="inner">
                                                            <e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
                                                                            var="blood_system"
                                                                            id="blood_system_list_view"
                                                                            style="width:100%;"
                                                                            value="#{bloodDonation.document.bloodSystems}">
                                                                <e5ui:column style="min-width:12em">
                                                                    <f:facet name="header">
                                                                        <p>Тип системы</p>
                                                                    </f:facet>
                                                                    <h:outputText value="#{blood_system.type.value}"
                                                                                  class="wide"/>
                                                                </e5ui:column>
                                                                <e5ui:column style="min-width:5em">
                                                                    <f:facet name="header">
                                                                        <p>Количество</p>
                                                                    </f:facet>
                                                                    <h:outputText value="#{blood_system.count}"/>
                                                                </e5ui:column>
                                                            </e5ui:dataTable>
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </td>
                                        </tr>
                                        <tr class="row">
                                            <td class="first">Медицинский регистратор:</td>
                                            <td>
                                                <h:outputText
                                                        value="#{bloodDonation.document.registrator.description}"/>
                                            </td>
                                        </tr>
                                        <tr class="row">
                                            <td class="first" colspan="2">
                                                <fieldset>
                                                    <legend>
                                                        <label>
                                                            <span class="title">Рекомендуемый</span>
                                                        </label>
                                                    </legend>
                                                    <div class="mrow">
                                                        <div class="wrap" style="width:100%; margin:0">
                                                            <div class="inner">
                                                                <e5ui:dataTable border="0" cellpadding="0"
                                                                                cellspacing="0" style="width:100%;"
                                                                                value="#{bloodDonation.document.entryList}"
                                                                                var="recommended_entry">
                                                                    <e5ui:column>
                                                                        <f:facet name="header">
                                                                            <p>Вид донорства</p>
                                                                        </f:facet>
                                                                        <h:outputText
                                                                                value="#{recommended_entry.donationType}"
                                                                                class="wide"/>
                                                                    </e5ui:column>
                                                                    <e5ui:column>
                                                                        <f:facet name="header">
                                                                            <p>Объем донации</p>
                                                                        </f:facet>
                                                                        <h:outputText value="#{recommended_entry.dose}"
                                                                                      style="margin-right:3px;"/>
                                                                        <span>мл</span>
                                                                    </e5ui:column>
                                                                </e5ui:dataTable>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                    <tr class="row">
                                        <td class="first">Фактическая дата донации:</td>
                                        <td>
                                            <h:outputText value="#{bloodDonation.document.factDate}" class="wide">
                                                <f:convertDateTime type="date" pattern="dd.MM.yyyy"/>
                                            </h:outputText>
                                        </td>
                                    </tr>
                                    <h:panelGroup rendered="#{bloodDonation.document.statusId ne 1}">
                                        <tr class="row">
                                            <td class="first" colspan="2">
                                                <fieldset>
                                                    <legend>
                                                        <label>
                                                            <span class="title">Фактический</span>
                                                        </label>
                                                    </legend>
                                                    <div class="mrow">
                                                        <div class="wrap" style="width:100%; margin:0">
                                                            <div class="inner">
                                                                <e5ui:dataTable border="0" cellpadding="0"
                                                                                cellspacing="0" style="width:100%;"
                                                                                value="#{bloodDonation.document.factEntryList}"
                                                                                var="fact_entry">
                                                                    <e5ui:column>
                                                                        <f:facet name="header">
                                                                            <p>Вид донорства</p>
                                                                        </f:facet>
                                                                        <h:outputText value="#{fact_entry.donationType}"
                                                                                      class="wide"/>
                                                                    </e5ui:column>
                                                                    <e5ui:column>
                                                                        <f:facet name="header">
                                                                            <p>Объем донации</p>
                                                                        </f:facet>
                                                                        <h:outputText value="#{fact_entry.dose}"
                                                                                      style="margin-right:3px;"/>
                                                                        <span>мл</span>
                                                                    </e5ui:column>
                                                                </e5ui:dataTable>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </td>
                                        </tr>
                                        <tr class="row">
                                            <td class="first">Осложнения:</td>
                                            <td>
                                                <h:outputText value="#{bloodDonation.document.complications}"
                                                              class="wide"/>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{bloodDonation.document.statusId gt 2}">
                                        <tr class="row">
                                            <td class="first">Номер бланка строгой отчетности:</td>
                                            <td>
                                                <h:outputText value="#{bloodDonation.document.reportBlankNumber}"
                                                              class="wide"/>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                    <tr class="row">
                                        <td class="first">Отправлено на анализы, мл:</td>
                                        <td>
                                            <h:outputText value="#{bloodDonation.document.analysisCount}" class="wide"/>
                                        </td>
                                    </tr>
                                    <h:panelGroup
                                            rendered="#{(bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 4) or (bloodDonation.document.statusId eq -1)}">
                                        <tr class="row">
                                            <td class="first" colspan="2">
                                                <fieldset>
                                                    <legend>
                                                        <label>
                                                            <span class="title">Технологические процессы</span>
                                                        </label>
                                                    </legend>
                                                    <h:selectManyCheckbox collectionType="java.util.HashSet"
                                                                          layout="pageDirection"
                                                                          value="#{bloodDonation.document.techProcesses}"
                                                                          converter="ClassifierConverter"
                                                                          disabled="true">
                                                        <f:selectItems
                                                                value="#{dictionaryManagement.getByCategory('Технологические процессы')}"/>
                                                    </h:selectManyCheckbox>
                                                </fieldset>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                    <tr class="row">
                                        <td class="first">Комментарии:</td>
                                        <td>
                                            <h:outputText value="#{bloodDonation.document.commentary}" class="wide"/>
                                        </td>
                                    </tr>
                                    <h:panelGroup rendered="#{bloodDonation.document.operationalRoom ne null}">
                                        <tr class="row">
                                            <td class="first" colspan="2">
                                                <fieldset>
                                                    <legend>
                                                        <label><span class="title">Операционная</span> </label>
                                                    </legend>
                                                    <table width="100%">
                                                        <tr class="row">
                                                            <td class="first">Наименование операционной:</td>
                                                            <td>
                                                                <h:outputText
                                                                        value="#{bloodDonation.document.operationalRoom.name}"
                                                                        class="wide"/>
                                                            </td>
                                                        </tr>
                                                        <tr class="row">
                                                            <td class="first">Врачи-трансфузиологи:</td>
                                                            <td>
                                                                <ui:repeat
                                                                        value="#{bloodDonation.document.operationalRoom.getDoctorsList()}"
                                                                        var="operationalDoctor">
                                                                    <h:outputText
                                                                            value="#{operationalDoctor.getDescription()}"
                                                                            class="wide"/> <br/>
                                                                </ui:repeat>
                                                            </td>
                                                        </tr>
                                                        <tr class="row">
                                                            <td class="first">Операционные медсестры:</td>
                                                            <td>
                                                                <ui:repeat
                                                                        value="#{bloodDonation.document.operationalRoom.getNursesList()}"
                                                                        var="operationalNurse">
                                                                    <h:outputText
                                                                            value="#{operationalNurse.getDescription()}"
                                                                            class="wide"/> <br/>
                                                                </ui:repeat>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </fieldset>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                </table>
                            </div>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{bloodDonation.createState or bloodDonation.editState}">
                            <div class="row">
                                <table class="form_grid">
                                    <tr class="row">
                                        <td class="first">
                                            Донор:
                                        </td>
                                        <td>
                                            <h:panelGroup id="donor_info">
                                                <h:outputText id="donor"
                                                              value="#{bloodDonation.document.donor.description}"
                                                              style="font-weight:bold;"
                                                              class="wide"/>
                                                <h:outputLink rendered="#{bloodDonation.document.donor ne null}"
                                                              style="margin-left:5px;"
                                                              value="/component/donor.xhtml"
                                                              target="_blank">
                                                    <h:graphicImage value="#{resource['images:link.png']}"/>
                                                    <f:param name="docId" value="#{bloodDonation.document.donor.id}"/>
                                                </h:outputLink>
                                            </h:panelGroup>
                                        </td>
                                    </tr>
                                    <tr class="row">
                                        <td class="first">Тип донора:</td>
                                        <td>
                                            <h:selectOneMenu id="donorType"
                                                             value="#{bloodDonation.document.donorType}"
                                                             converter="ClassifierConverter">
                                                <f:selectItems
                                                        value="#{dictionaryManagement.getByCategory('Тип донора')}"/>
                                            </h:selectOneMenu>
                                        </td>
                                    </tr>
                                    <h:panelGroup
                                            rendered="#{not ((bloodDonation.document.statusId eq 2) and (sessionManagement.operational))}">
                                        <tr class="row">
                                            <td class="first">Дата/время регистрации:</td>
                                            <td>
                                                <h:outputText value="#{bloodDonation.document.created}" class="wide">
                                                    <f:convertDateTime type="date" pattern="dd.MM.yyyy HH:mm"/>
                                                </h:outputText>
                                            </td>
                                        </tr>
                                        <tr class="row">
                                            <td class="first">Первичный осмотр:</td>
                                            <td>
                                                <h:outputText id="therapist"
                                                              value="#{bloodDonation.document.therapist.description}"/>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{bloodDonation.document.statusId ne 1}">
                                        <tr class="row">
                                            <td class="first" colspan="2">
                                                <fieldset>
                                                    <legend>
                                                        <label>
                                                            <span class="title">Системы крови</span>
                                                        </label>
                                                    </legend>
                                                    <h:panelGroup id="blood_systems_editable">
                                                        <div class="row">
                                                            <div class="actionbar">
                                                                <div class="menu">
                                                                    <div class="defbutton">
                                                                        <h:outputLink
                                                                                onclick="bloodSystemTypeSelectVar.clickOpen('bloodSystemTypeSelectModal'); return false;">
                                                                            <h:graphicImage
                                                                                    value="#{resource['images:plus.png']}"/>
                                                                            Добавить
                                                                        </h:outputLink>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="wrap" style="width:100%; margin:0">
                                                            <div class="inner">
                                                                <e5ui:dataTable border="0" cellpadding="0"
                                                                                cellspacing="0"
                                                                                var="blood_system"
                                                                                id="blood_system_list"
                                                                                style="width:100%;"
                                                                                value="#{bloodDonation.document.bloodSystems}">
                                                                    <e5ui:column style="min-width:12em">
                                                                        <f:facet name="header">
                                                                            <p>Тип системы</p>
                                                                        </f:facet>
                                                                        <h:outputText value="#{blood_system.type.value}"
                                                                                      class="wide"/>
                                                                    </e5ui:column>
                                                                    <e5ui:column style="min-width:5em">
                                                                        <f:facet name="header">
                                                                            <p>Количество</p>
                                                                        </f:facet>
                                                                        <h:inputText value="#{blood_system.count}"
                                                                                     size="4">
                                                                            <f:convertNumber integerOnly="true"/>
                                                                        </h:inputText>
                                                                    </e5ui:column>
                                                                    <e5ui:column style="min-width:3em">
                                                                        <f:facet name="header">
                                                                            <p>Удалить</p>
                                                                        </f:facet>

                                                                        <div class="defbutton">
                                                                            <h:commandLink
                                                                                    action="#{bloodDonation.document.bloodSystems.remove(row)}">
                                                                                <f:ajax render=":main_content_form:blood_systems_editable"/>
                                                                                <h:graphicImage
                                                                                        value="#{resource['images:minus.png']}"/>
                                                                            </h:commandLink>
                                                                        </div>
                                                                    </e5ui:column>
                                                                </e5ui:dataTable>
                                                            </div>
                                                        </div>
                                                    </h:panelGroup>

                                                    <e5ui-comp:modalWindow id="bloodSystemTypeSelectModal"
                                                                           modalWindowHolder="#{bloodDonation.bloodSystemTypeSelectModal}"
                                                                           render=":main_content_form:blood_systems_editable"
                                                                           execute="blood_select_table"
                                                                           showButtons="false"
                                                                           style="width: 500px;"
                                                                           widgetVar="bloodSystemTypeSelectVar">
                                                        <div id="title">Выбор типа системы крови</div>
                                                        <div id="blood_modal_container" style="margin-top: 0;">
                                                            <div class="wrap" style="height: 300px;">
                                                                <div class="inner" style="height: 300px;">
                                                                    <h:outputScript>
                                                                        jQuery(function () {
                                                                            if ($("[id='blood_modal_container']").size() != 0) {
                                                                                var countSelected = $("[id='blood_modal_container']").find("tbody tr[class*='grid_row_selected']").size();
                                                                                if (countSelected == 0) {
                                                                                    $("[id='blood_modal_container']").find("tbody tr:first").click();
                                                                                }
                                                                            }
                                                                        });
                                                                    </h:outputScript>
                                                                    <e5ui:dataTable id="blood_select_table" border="0"
                                                                                    cellpadding="0" cellspacing="0"
                                                                                    value="#{bloodSystemTypeList.documents}"
                                                                                    var="row" grouping="false"
                                                                                    width="100%">
                                                                        <e5ui:row
                                                                                onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                                styleClass="#{bloodDonation.bloodSystemTypeSelectModal.selected(row)? 'grid_row_selected': ''}"/>
                                                                        <e5ui:column>
                                                                            <f:facet name="header">
                                                                                <p>Название</p>
                                                                            </f:facet>
                                                                            <h:outputText value="#{row.value}"/>
                                                                            <h:commandLink id="selectLink"
                                                                                           style="display: none;"
                                                                                           rendered="#{not bloodDonation.bloodSystemTypeSelectModal.selected(row)}"
                                                                                           action="#{bloodDonation.bloodSystemTypeSelectModal.select(row)}"/>
                                                                        </e5ui:column>
                                                                    </e5ui:dataTable>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="e5ui-modal-bottombuttons">
                                                            <h:button
                                                                    onclick="bloodSystemTypeSelectVar.clickSave(); return false;"
                                                                    value="Выбрать"/>
                                                            <h:button
                                                                    onclick="bloodSystemTypeSelectVar.clickClose(); return false;"
                                                                    value="Отмена"/>
                                                        </div>
                                                    </e5ui-comp:modalWindow>
                                                </fieldset>
                                            </td>
                                        </tr>

                                    </h:panelGroup>
                                    <h:panelGroup
                                            rendered="#{not ((bloodDonation.document.statusId eq 2) and (sessionManagement.operational))}">
                                        <tr class="row">
                                            <td class="first">
                                                <h:outputLink
                                                        onclick="registratorSelectVar.clickOpen('registratorSelectModal'); return false;">
                                                    Медицинский регистратор:
                                                </h:outputLink>
                                            </td>
                                            <td>
                                                <h:outputText id="registrator"
                                                              value="#{bloodDonation.document.registrator.description}"
                                                              class="wide"/>
                                                <e5ui-comp:modalWindow id="registratorSelectModal"
                                                                       modalWindowHolder="#{bloodDonation.registratorSelectModal}"
                                                                       render=":main_content_form:registrator"
                                                                       execute="user_select_table"
                                                                       showButtons="false"
                                                                       style="width: 500px;"
                                                                       widgetVar="registratorSelectVar">
                                                    <div id="title">Выбор медицинского регистратора</div>
                                                    <div id="user_list" style="margin-top:0;">
                                                        <div class="searchbar">
                                                            <h:inputText id="filter_string"
                                                                         value="#{bloodDonation.registratorSelectModal.userList.filter}"
                                                                         style="display:block; float:left; margin-right:10px;"
                                                                         title="Поиск"/>
                                                            <h:commandButton value=" "
                                                                             action="#{bloodDonation.registratorSelectModal.userList.changePageOffset(0)}"
                                                                             styleClass="searchbutton">
                                                                <f:ajax execute=":main_content_form:registratorSelectModal:filter_string"
                                                                        render=":main_content_form:registratorSelectModal:user_select_table :main_content_form:registratorSelectModal:user_paging"/>
                                                            </h:commandButton>
                                                        </div>
                                                        <div class="wrap"
                                                             style="height:300px; background-color:#fff; clear:both;">
                                                            <div class="inner" style="height:300px;">
                                                                <e5ui:dataTable id="user_select_table" border="0"
                                                                                cellpadding="0" cellspacing="0"
                                                                                value="#{bloodDonation.registratorSelectModal.userList.documents}"
                                                                                var="row" grouping="false" width="100%">
                                                                    <e5ui:row
                                                                            onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                            styleClass="#{bloodDonation.registratorSelectModal.selected(row)? 'grid_row_selected': ''}"/>
                                                                    <e5ui:column>
                                                                        <f:facet name="header">
                                                                            <p>Медицинский регистратор</p>
                                                                        </f:facet>
                                                                        <h:outputText value="#{row.description}"/>
                                                                        <h:commandLink id="selectLink"
                                                                                       style="display: none;"
                                                                                       rendered="#{not bloodDonation.registratorSelectModal.selected(row)}"
                                                                                       action="#{bloodDonation.registratorSelectModal.select(row)}"/>
                                                                    </e5ui:column>
                                                                </e5ui:dataTable>
                                                            </div>
                                                        </div>
                                                        <div style="clear:both;">
                                                            <h:panelGroup id="user_paging">
                                                                <e5ui-comp:tablePager
                                                                        documentListHolder="#{bloodDonation.registratorSelectModal.userList}"/>
                                                            </h:panelGroup>
                                                        </div>
                                                    </div>
                                                    <div class="e5ui-modal-bottombuttons">
                                                        <h:button
                                                                onclick="registratorSelectVar.clickSave(); return false;"
                                                                value="Выбрать"/>
                                                        <h:button
                                                                onclick="registratorSelectVar.clickClose(); return false;"
                                                                value="Отмена"/>
                                                    </div>
                                                </e5ui-comp:modalWindow>
                                            </td>
                                        </tr>

                                        <h:panelGroup
                                                rendered="#{not ((bloodDonation.document.statusId eq 1) and (sessionManagement.loggedUser.id eq bloodDonation.document.therapist.id))}">
                                            <tr class="row">
                                                <td class="first" colspan="2">
                                                    <fieldset>
                                                        <legend>
                                                            <label><span class="title">Рекомендуемый</span> </label>
                                                        </legend>
                                                        <div class="row">
                                                            <div class="wrap" style="width:100%; margin:0">
                                                                <div class="inner">
                                                                    <e5ui:dataTable border="0" cellpadding="0"
                                                                                    cellspacing="0" style="width:100%;"
                                                                                    value="#{bloodDonation.document.entryList}"
                                                                                    var="row">
                                                                        <e5ui:column>
                                                                            <f:facet name="header">
                                                                                <p>Вид донорства</p>
                                                                            </f:facet>
                                                                            <h:outputText value="#{row.donationType}"
                                                                                          class="wide"
                                                                                          converter="BloodDonationTypeConverter"/>
                                                                        </e5ui:column>
                                                                        <e5ui:column>
                                                                            <f:facet name="header">
                                                                                <p>Объем донации</p>
                                                                            </f:facet>
                                                                            <h:outputText value="#{row.dose}"
                                                                                          style="margin-right:3px;"/>
                                                                            <span>мл</span>
                                                                        </e5ui:column>
                                                                    </e5ui:dataTable>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </fieldset>
                                                </td>
                                            </tr>
                                        </h:panelGroup>
                                        <h:panelGroup
                                                rendered="#{(bloodDonation.document.statusId eq 1) and (sessionManagement.loggedUser.id eq bloodDonation.document.therapist.id)}">
                                            <tr class="row">
                                                <td class="first" colspan="2">
                                                    <fieldset>
                                                        <legend>
                                                            <label><span class="title">Рекомендуемый</span> </label>
                                                        </legend>
                                                        <div class="row">
                                                            <div class="actionbar">
                                                                <div class="menu">
                                                                    <div class="defbutton">
                                                                        <h:commandLink
                                                                                action="#{bloodDonation.document.addEntry()}">
                                                                            <h:graphicImage
                                                                                    value="#{resource['images:plus.png']}"/>
                                                                            <f:ajax render=":main_content_form:entry_list"
                                                                                    execute=":main_content_form:entry_list"/>
                                                                            Добавить
                                                                        </h:commandLink>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="wrap" style="width:100%; margin:0px">
                                                                <div class="inner">
                                                                    <e5ui:dataTable border="0" cellpadding="0"
                                                                                    cellspacing="0"
                                                                                    id="entry_list" style="width:100%;"
                                                                                    value="#{bloodDonation.document.entryList}"
                                                                                    var="row">
                                                                        <e5ui:column style="min-width:12em;">
                                                                            <f:facet name="header">
                                                                                <p>Вид донорства</p>
                                                                            </f:facet>
                                                                            <h:selectOneMenu value="#{row.donationType}"
                                                                                             converter="BloodDonationTypeConverter">
                                                                                <f:selectItems
                                                                                        value="#{dictionaryManagement.bloodDonationTypes}"/>
                                                                            </h:selectOneMenu>
                                                                        </e5ui:column>
                                                                        <e5ui:column style="min-width:5em;">
                                                                            <f:facet name="header">
                                                                                <p>Объем донации</p>
                                                                            </f:facet>
                                                                            <h:inputText value="#{row.dose}" size="4"
                                                                                         style="margin-right:3px;"/>
                                                                            <span>мл</span>
                                                                        </e5ui:column>
                                                                        <e5ui:column style="min-width:3em;"
                                                                                     rendered="false">
                                                                            <f:facet name="header">
                                                                                <p>Удалить</p>
                                                                            </f:facet>

                                                                            <div class="defbutton">
                                                                                <h:commandLink
                                                                                        action="#{bloodDonation.document.removeEntry(row)}">
                                                                                    <f:ajax render=":main_content_form:entry_list"/>
                                                                                    <h:graphicImage
                                                                                            value="#{resource['images:minus.png']}"/>
                                                                                </h:commandLink>
                                                                            </div>
                                                                        </e5ui:column>
                                                                    </e5ui:dataTable>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </fieldset>
                                                </td>
                                            </tr>
                                        </h:panelGroup>
                                    </h:panelGroup>
                                    <tr class="row">
                                        <td class="first">Фактическая дата донации:</td>
                                        <td>
                                            <h:outputText value="#{bloodDonation.document.factDate}" class="wide">
                                                <f:convertDateTime type="date" pattern="dd.MM.yyyy"/>
                                            </h:outputText>
                                        </td>
                                    </tr>
                                    <h:panelGroup
                                            rendered="#{(bloodDonation.document.statusId ne 1) and (not ((bloodDonation.document.statusId gt 1) and ((sessionManagement.loggedUser.id eq bloodDonation.document.transfusiologist.id) or sessionManagement.operational or bloodDonation.transfusiologist or bloodDonation.headNurse)))}">
                                        <tr class="row">
                                            <td class="first" colspan="2">
                                                <fieldset>
                                                    <legend>
                                                        <label><span class="title">Фактический</span> </label>
                                                    </legend>
                                                    <div class="row">
                                                        <div class="wrap" style="width:100%; margin:0px">
                                                            <div class="inner">
                                                                <e5ui:dataTable border="0" cellpadding="0"
                                                                                cellspacing="0" style="width:100%;"
                                                                                value="#{bloodDonation.document.factEntryList}"
                                                                                var="row">
                                                                    <e5ui:column>
                                                                        <f:facet name="header">
                                                                            <p>Вид донорства</p>
                                                                        </f:facet>
                                                                        <h:outputText value="#{row.donationType}"
                                                                                      class="wide"
                                                                                      converter="BloodDonationTypeConverter"/>
                                                                    </e5ui:column>
                                                                    <e5ui:column>
                                                                        <f:facet name="header">
                                                                            <p>Объем донации</p>
                                                                        </f:facet>
                                                                        <h:outputText value="#{row.dose}"
                                                                                      style="margin-right:3px;"/>
                                                                        <span>мл</span>
                                                                    </e5ui:column>
                                                                </e5ui:dataTable>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </td>
                                        </tr>
                                        <tr class="row">
                                            <td class="first">Номер бланка строгой отчетности:</td>
                                            <td>
                                                <h:outputText value="#{bloodDonation.document.reportBlankNumber}"
                                                              class="wide"/>
                                            </td>
                                        </tr>
                                        <tr class="row">
                                            <td class="first">Осложнения:</td>
                                            <td>
                                                <h:outputText value="#{bloodDonation.document.complications}"
                                                              class="wide"/>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                    <h:panelGroup
                                            rendered="#{(bloodDonation.document.statusId gt 1) and ((sessionManagement.loggedUser.id eq bloodDonation.document.transfusiologist.id) or sessionManagement.operational or bloodDonation.transfusiologist or bloodDonation.headNurse)}">
                                        <tr class="row">
                                            <td class="first" colspan="2">
                                                <fieldset>
                                                    <legend>
                                                        <label><span class="title">Фактический</span> </label>
                                                    </legend>
                                                    <h:panelGroup id="fact_donation_editable">
                                                        <div class="row">
                                                            <div class="actionbar">
                                                                <div class="menu">
                                                                    <h:panelGroup
                                                                            rendered="#{bloodDonation.document.pheresisNecessary}">
                                                                        <div class="defbutton">
                                                                            <h:commandLink
                                                                                    action="#{bloodDonation.document.addPheresis()}">
                                                                                <h:graphicImage
                                                                                        value="#{resource['images:blank.png']}"/>
                                                                                <f:ajax render="main_content_form"
                                                                                        execute="main_content_form"/>
                                                                                Добавить протокол цитафереза
                                                                            </h:commandLink>
                                                                        </div>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>
                                                            <div class="wrap" style="width:100%; margin:0px">
                                                                <div class="inner">
                                                                    <e5ui:dataTable border="0" cellpadding="0"
                                                                                    cellspacing="0" var="row"
                                                                                    id="fact_entry_list"
                                                                                    style="width:100%;"
                                                                                    value="#{bloodDonation.document.factEntryList}">
                                                                        <e5ui:column style="min-width:12em;">
                                                                            <f:facet name="header">
                                                                                <p>Вид донорства</p>
                                                                            </f:facet>
                                                                            <h:selectOneMenu value="#{row.donationType}"
                                                                                             converter="BloodDonationTypeConverter">
                                                                                <f:selectItems
                                                                                        value="#{dictionaryManagement.bloodDonationTypes}"/>
                                                                            </h:selectOneMenu>
                                                                        </e5ui:column>
                                                                        <e5ui:column style="min-width:5em;">
                                                                            <f:facet name="header">
                                                                                <p>Объем донации</p>
                                                                            </f:facet>
                                                                            <h:inputText value="#{row.dose}" size="4"
                                                                                         style="margin-right:3px;"/>
                                                                            <span>мл</span>
                                                                        </e5ui:column>
                                                                        <e5ui:column style="min-width:3em;"
                                                                                     rendered="false">
                                                                            <f:facet name="header">
                                                                                <p>Удалить</p>
                                                                            </f:facet>

                                                                            <div class="defbutton">
                                                                                <h:commandLink
                                                                                        action="#{bloodDonation.document.removeFactEntry(row)}">
                                                                                    <f:ajax render=":main_content_form:fact_entry_list"/>
                                                                                    <h:graphicImage
                                                                                            value="#{resource['images:minus.png']}"/>
                                                                                </h:commandLink>
                                                                            </div>
                                                                        </e5ui:column>
                                                                    </e5ui:dataTable>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </h:panelGroup>
                                                </fieldset>
                                            </td>
                                        </tr>
                                        <tr class="row">
                                            <td class="first">Осложнения:</td>
                                            <td>
                                                <h:inputText value="#{bloodDonation.document.complications}"
                                                             class="wide"/>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                    <h:panelGroup
                                            rendered="#{bloodDonation.document.statusId gt 2 and ((sessionManagement.loggedUser.id eq bloodDonation.document.registrator.id) or bloodDonation.registrator or bloodDonation.headNurse)}">
                                        <tr class="row">
                                            <td class="first">Номер бланка строгой отчетности:</td>
                                            <td>
                                                <h:inputText value="#{bloodDonation.document.reportBlankNumber}"
                                                             class="wide"/>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                    <h:panelGroup
                                            rendered="#{bloodDonation.document.statusId gt 2 and not ((sessionManagement.loggedUser.id eq bloodDonation.document.registrator.id) or bloodDonation.registrator or bloodDonation.headNurse)}">
                                        <tr class="row">
                                            <td class="first">Номер бланка строгой отчетности:</td>
                                            <td>
                                                <h:outputText value="#{bloodDonation.document.reportBlankNumber}"
                                                              class="wide"/>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                    <tr class="row">
                                        <td class="first">Отправлено на анализы, мл:</td>
                                        <td>
                                            <h:inputText value="#{bloodDonation.document.analysisCount}" class="wide"/>
                                        </td>
                                    </tr>
                                    <h:panelGroup
                                            rendered="#{(bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 4) or (bloodDonation.document.statusId eq -1)}">
                                        <tr class="row">
                                            <td class="first" colspan="2">
                                                <fieldset>
                                                    <legend>
                                                        <label><span class="title">Технологические процессы</span>
                                                        </label>
                                                    </legend>
                                                    <h:selectManyCheckbox style="width:100%;"
                                                                          collectionType="java.util.HashSet"
                                                                          layout="pageDirection"
                                                                          value="#{bloodDonation.document.techProcesses}"
                                                                          converter="ClassifierConverter">
                                                        <f:selectItems
                                                                value="#{dictionaryManagement.getByCategory('Технологические процессы')}"/>
                                                    </h:selectManyCheckbox>
                                                </fieldset>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                    <tr class="row">
                                        <td class="first">Комментарии:</td>
                                        <td>
                                            <h:inputTextarea value="#{bloodDonation.document.commentary}"/>
                                        </td>
                                    </tr>
                                    <h:panelGroup rendered="#{bloodDonation.document.operationalRoom ne null}">
                                        <tr class="row">
                                            <td class="first" colspan="2">
                                                <fieldset>
                                                    <legend>
                                                        <label><span class="title">Операционная</span> </label>
                                                    </legend>
                                                    <table width="100%">
                                                        <tr class="row">
                                                            <td class="first">Наименование операционной:</td>
                                                            <td>
                                                                <h:outputText
                                                                        value="#{bloodDonation.document.operationalRoom.name}"
                                                                        class="wide"/>
                                                            </td>
                                                        </tr>
                                                        <tr class="row">
                                                            <td class="first">Врачи-трансфузиологи:</td>
                                                            <td>
                                                                <ui:repeat
                                                                        value="#{bloodDonation.document.operationalRoom.getDoctorsList()}"
                                                                        var="operationalDoctor">
                                                                    <h:outputText
                                                                            value="#{operationalDoctor.getDescription()}"
                                                                            class="wide"/> <br/>
                                                                </ui:repeat>
                                                            </td>
                                                        </tr>
                                                        <tr class="row">
                                                            <td class="first">Операционные медсестры:</td>
                                                            <td>
                                                                <ui:repeat
                                                                        value="#{bloodDonation.document.operationalRoom.getNursesList()}"
                                                                        var="operationalNurse">
                                                                    <h:outputText
                                                                            value="#{operationalNurse.getDescription()}"
                                                                            class="wide"/> <br/>
                                                                </ui:repeat>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </fieldset>
                                            </td>
                                        </tr>
                                    </h:panelGroup>
                                </table>
                            </div>
                        </h:panelGroup>
                    </fieldset>
                </div>
                <h:panelGroup rendered="#{bloodDonation.document.statusId ne 1}" id="blood_components">
                    <div style="overflow: auto;">
                        <fieldset>
                            <legend>
                                <label><span class="title">Компоненты крови</span> </label>
                            </legend>
                            <script type="text/javascript">
                                document.ondblclick = function DoubleClick(evt) {
                                    if (window.getSelection)
                                        window.getSelection().removeAllRanges();
                                    else if (document.selection)
                                        document.selection.empty();
                                }
                            </script>
                            <h:outputScript>
                                function goToDocument(id) {
                                    if (id != "") {
                                        window.open('/component/blood_component.xhtml?docId='
                                        + id,'_blank');
                                    }
                                }
                            </h:outputScript>

                            <div class="actionbar">
                                <div class="menu">
                                    <h:panelGroup rendered="#{bloodDonation.document.statusId gt 3}">
                                        <div class="defbutton">
                                            <h:outputLink value="/component/blood_component.xhtml"
                                                          target="_blank">
                                                <h:graphicImage value="#{resource['images:newf_buttn_icon.png']}"/>
                                                Новый компонент
                                                <f:param name="docAction" value="create"/>
                                                <f:param name="donationId" value="#{bloodDonation.document.id}"/>
                                            </h:outputLink>
                                        </div>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{bloodDonation.componentRegistrationAvailable}">
                                        <div class="defbutton">
                                            <h:commandLink action="#{bloodDonation.componentRegister}">
                                                <h:graphicImage value="#{resource['images:newf_buttn_icon.png']}"/>
                                                Создать компоненты
                                            </h:commandLink>
                                        </div>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{bloodDonation.componentRejectionAvailable}">
                                        <div class="defbutton">
                                            <h:outputLink
                                                    onclick="rejectionDescriptionHolder.clickOpen('rejectionDescriptionHolder'); return false;">
                                                <h:graphicImage value="#{resource['images:broken.png']}"/>
                                                Брак по операционной
                                            </h:outputLink>
                                            <e5ui-comp:modalWindow id="rejectionDescriptionHolder"
                                                                   modalWindowHolder="#{bloodDonation.rejectionDescriptionHolder}"
                                                                   showButtons="false"
                                                                   style="width:400px;"
                                                                   widgetVar="rejectionDescriptionHolder">
                                                <div id="title">Причина брака</div>
                                                <div style="margin-top:0;">
                                                    <h:panelGroup
                                                            rendered="#{bloodDonation.rejectionDescriptionHolder.editableState}">
                                                        <label><span class="title">Комментарий</span></label>
                                                        <h:inputText styleClass="wide"
                                                                     value="#{bloodDonation.rejectionDescriptionHolder.description}">
                                                            <f:ajax/>
                                                        </h:inputText>
                                                    </h:panelGroup>
                                                    <h:panelGroup
                                                            rendered="#{not (bloodDonation.rejectionDescriptionHolder.editableState)}">
                                                        <div style="padding-left: 10px;">
                                                            <ui:repeat
                                                                    value="#{bloodDonation.rejectionDescriptionHolder.description.split(':')}"
                                                                    var="element">
                                                                <h:outputText value="#{element}"/>
                                                                <br/>
                                                            </ui:repeat>
                                                        </div>
                                                    </h:panelGroup>
                                                </div>
                                                <div class="e5ui-modal-bottombuttons">
                                                    <h:commandButton
                                                            action="#{bloodDonation.rejectionDescriptionHolder.compose}"
                                                            rendered="#{bloodDonation.rejectionDescriptionHolder.editableState}"
                                                            value="ОК"/>
                                                    <h:button
                                                            onclick="rejectionDescriptionHolder.clickClose(); return false;"
                                                            rendered="#{bloodDonation.rejectionDescriptionHolder.editableState}"
                                                            value="Отмена"/>
                                                    <h:button
                                                            onclick="rejectionDescriptionHolder.clickClose(); return false;"
                                                            rendered="#{not(bloodDonation.rejectionDescriptionHolder.editableState)}"
                                                            value="ОК"/>
                                                </div>
                                            </e5ui-comp:modalWindow>
                                        </div>
                                    </h:panelGroup>

                                    <div class="defbutton">
                                        <h:commandLink action="false;">
                                            <f:ajax render=":main_content_form:components_list"/>
                                            <h:graphicImage value="#{resource['images:button-refresh.png']}"/>
                                            Обновить
                                        </h:commandLink>
                                    </div>
                                </div>
                            </div>
                            <div class="wrap" style="height:300px;  width: 100%; margin: 0px">
                                <div class="inner" style="height:300px;">
                                    <e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
                                                    id="components_list"
                                                    value="#{bloodComponentList.getDocumentsByDonation(bloodDonation.document.id)}"
                                                    var="row" grouping="false">
                                        <e5ui:row ondblclick="goToDocument('#{row.id}');"/>
                                        <e5ui:column style="min-width:5em">
                                            <f:facet name="header">
                                                <p>Номер</p>
                                            </f:facet>
                                            <h:outputText value="#{row.number}"/>
                                        </e5ui:column>
                                        <e5ui:column style="min-width:7em">
                                            <f:facet name="header">
                                                <p>Компонент</p>
                                            </f:facet>
                                            <h:outputText value="#{row.componentType}"
                                                          converter="BloodComponentTypeConverter"/>
                                        </e5ui:column>
                                        <e5ui:column style="min-width:6em">
                                            <f:facet name="header">
                                                <p>Объем</p>
                                            </f:facet>
                                            <h:outputText value="#{row.volume}"/>
                                        </e5ui:column>
                                        <e5ui:column style="min-width:7em">
                                            <f:facet name="header">
                                                <p>Антикоагулянт</p>
                                            </f:facet>
                                            <h:outputText value="#{row.anticoagulant}"
                                                          converter="AnticoagulantConverter"/>
                                        </e5ui:column>
                                        <e5ui:column style="min-width:7em">
                                            <f:facet name="header">
                                                <p>Группа крови</p>
                                            </f:facet>
                                            <h:outputText value="#{row.bloodGroup}" converter="BloodGroupConverter"/>
                                            <h:outputText style="margin-left:5px;" value="#{row.rhesusFactor}"
                                                          converter="ClassifierConverter"/>
                                        </e5ui:column>
                                        <e5ui:column style="min-width:7em">
                                            <f:facet name="header">
                                                <p>Срок хранения</p>
                                            </f:facet>
                                            <h:outputText value="#{row.expirationDate}">
                                                <f:convertDateTime type="date" pattern="dd.MM.yyyy"/>
                                            </h:outputText>
                                        </e5ui:column>
                                        <e5ui:column style="min-width:7em">
                                            <f:facet name="header">
                                                <p>Статус</p>
                                            </f:facet>
                                            <h:outputText value="#{row.statusName}"/>
                                        </e5ui:column>
                                    </e5ui:dataTable>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </h:panelGroup>

                <div style="overflow: auto;">
                    <fieldset>
                        <legend>
                            <a onmouseout="setCursor('default')" onmouseover="setCursor('pointer')"
                               onclick="changeVisibleHistory();" style="color: #4581c0">История</a>
                        </legend>
                        <div id="history" class="wrap" style="width: 100%; margin: 0">
                            <div class="inner">
                                <e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
                                                id="history_list"
                                                value="#{bloodDonation.document.historyList}"
                                                var="row" grouping="false">
                                    <e5ui:column style="min-width:7em">
                                        <f:facet name="header">
                                            <p>Дата</p>
                                        </f:facet>
                                        <h:outputText value="#{row.startDate}">
                                            <f:convertDateTime type="date" pattern="dd.MM.yyyy HH:mm"/>
                                        </h:outputText>
                                    </e5ui:column>
                                    <e5ui:column style="min-width:8em">
                                        <f:facet name="header">
                                            <p>Со статуса</p>
                                        </f:facet>
                                        <h:outputText value="#{row.fromStatusName}"/>
                                    </e5ui:column>
                                    <e5ui:column style="min-width:8em">
                                        <f:facet name="header">
                                            <p>Действие</p>
                                        </f:facet>
                                        <h:outputText value="#{row.actionName}"/>
                                    </e5ui:column>
                                    <e5ui:column style="min-width:8em">
                                        <f:facet name="header">
                                            <p>На статус</p>
                                        </f:facet>
                                        <h:outputText value="#{row.toStatusName}"/>
                                    </e5ui:column>
                                    <e5ui:column style="min-width:12em">
                                        <f:facet name="header">
                                            <p>Автор</p>
                                        </f:facet>
                                        <h:outputText value="#{row.owner.descriptionShort}"/>
                                    </e5ui:column>
                                    <e5ui:column style="min-width:10em">
                                        <f:facet name="header">
                                            <p>Комментарий</p>
                                        </f:facet>
                                        <h:outputText value="#{row.commentary}"/>
                                    </e5ui:column>
                                </e5ui:dataTable>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <h:panelGroup rendered="#{bloodDonation.document.statusId ne 1}">
                <div class="tileright">
                    <h:panelGroup
                            rendered="#{(bloodDonation.document.statusId gt 2) or (bloodDonation.document.statusId eq -1) or (bloodDonation.document.statusId eq -2)}">
                        <div>
                            <fieldset>
                                <legend>
                                    <label><span class="title">
										Результаты анализов
										<h:panelGroup
                                                rendered="#{sessionManagement.admin and (bloodDonation.document.appointment ne null)}">
                                            <h:commandLink style="margin-left:3px;"
                                                           action="#{applicationSetup.initializeExternalAnalysisHistoryModal(bloodDonation.document.appointment)}">
                                                ...
                                            </h:commandLink>
                                        </h:panelGroup>
									</span></label>
                                </legend>
                                <e5ui-comp:modalWindow id="externalAnalysisHistoryModal"
                                                       modalWindowHolder="#{applicationSetup.externalAnalysisHistoryModal}"
                                                       style="min-width:600px;" showButtons="false"
                                                       widgetVar="externalAnalysisHistoryModal">
                                    <div id="title">Поступившие результаты анализов</div>
                                    <div id="modal_container" style="margin-top: 0;">
                                        <div class="wrap" style="height:300px;">
                                            <div class="inner" style="height:300px;">
                                                <e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
                                                                value="#{applicationSetup.externalAnalysisHistoryModal.entries}"
                                                                style="width:100%;" var="row" grouping="false">
                                                    <e5ui:column style="min-width:3em;">
                                                        <f:facet name="header">
                                                            <p>Код</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.indicatorCode}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:6em;">
                                                        <f:facet name="header">
                                                            <p>Название</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.indicatorName}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:4em;">
                                                        <f:facet name="header">
                                                            <p>Прибор</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.deviceName}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:4em;">
                                                        <f:facet name="header">
                                                            <p>Значение</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.resultValueText}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:4em;">
                                                        <f:facet name="header">
                                                            <p>Ед. изм.</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.resultUnit}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:4em;">
                                                        <f:facet name="header">
                                                            <p>Норма</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.resultNormString}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:4em;">
                                                        <f:facet name="header">
                                                            <p>Выполнено</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.resultSignDate}">
                                                            <f:convertDateTime type="date" pattern="dd.MM.yyyy HH:mm"/>
                                                        </h:outputText>
                                                    </e5ui:column>
                                                </e5ui:dataTable>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="e5ui-modal-bottombuttons">
                                        <h:button onclick="externalAnalysisHistoryModal.clickClose(); return false;"
                                                  value="Закрыть"/>
                                    </div>
                                </e5ui-comp:modalWindow>

                                <div class="wrap">
                                    <div class="inner">
                                        <e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
                                                        value="#{bloodDonation.document.testList}"
                                                        style="width:100%;" var="row" grouping="false">
                                            <e5ui:column style="min-width:4em;">
                                                <f:facet name="header">
                                                    <p>Анализ</p>
                                                </f:facet>
                                                <h:outputText value="#{row.type.value}"/>
                                            </e5ui:column>
                                            <e5ui:column style="min-width:15em;">
                                                <f:facet name="header">
                                                    <p>Результат</p>
                                                </f:facet>
                                                <h:panelGroup rendered="#{row.valueType eq 2}">
                                                    <h:commandLink
                                                            action="#{applicationSetup.initializeAnalysisValueListModal(row)}">
                                                        <h:outputText value="#{row.valueShort}"/>
                                                    </h:commandLink>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{row.valueType ne 2}">
                                                    <h:panelGroup
                                                            rendered="#{((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState}">
                                                        <h:panelGroup rendered="#{row.type.fieldType eq 0}">
                                                            <h:inputText class="wide" value="#{row.value}"/>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{row.type.fieldType eq 1}">
                                                            <h:inputTextarea class="wide" value="#{row.value}"/>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{row.type.fieldType eq 3}">
                                                            <h:selectOneMenu value="#{row.value}">
                                                                <f:selectItems
                                                                        value="#{dictionaryManagement.getValuesByCategoryWithEmpty(row.type.value)}"/>
                                                            </h:selectOneMenu>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{row.type.fieldType eq 4}">
                                                            <h:selectOneRadio layout="lineDirection"
                                                                              value="#{row.value}">
                                                                <f:selectItems
                                                                        value="#{dictionaryManagement.getValuesByCategoryWithEmpty(row.type.value)}"/>
                                                            </h:selectOneRadio>
                                                        </h:panelGroup>
                                                    </h:panelGroup>
                                                    <h:panelGroup
                                                            rendered="#{not (((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState)}">
                                                        <h:outputText value="#{row.value}" class="wide"/>
                                                    </h:panelGroup>
                                                </h:panelGroup>
                                            </e5ui:column>
                                            <e5ui:column rendered="false" style="min-width:5em;">
                                                <f:facet name="header">
                                                    <p>Ед. измерения</p>
                                                </f:facet>
                                                <h:panelGroup
                                                        rendered="#{((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState}">
                                                    <h:panelGroup rendered="#{row.type.fieldType lt 2}">
                                                        <h:inputText value="#{row.unit}" size="3"/>
                                                    </h:panelGroup>
                                                </h:panelGroup>
                                                <h:panelGroup
                                                        rendered="#{not (((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState)}">
                                                    <h:panelGroup rendered="#{row.type.fieldType lt 2}">
                                                        <h:outputText value="#{row.unit}"/>
                                                    </h:panelGroup>
                                                </h:panelGroup>
                                            </e5ui:column>
                                            <e5ui:column rendered="false" style="min-width:4em;">
                                                <f:facet name="header">
                                                    <p>Норма</p>
                                                </f:facet>
                                                <h:panelGroup rendered="#{row.type.fieldType lt 2}">
                                                    <h:panelGroup
                                                            rendered="#{((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState}">
                                                        <h:inputText value="#{row.normValue}" size="3"/>
                                                    </h:panelGroup>
                                                    <h:panelGroup
                                                            rendered="#{not (((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState)}">
                                                        <h:outputText value="#{row.normValue}"/>
                                                    </h:panelGroup>
                                                </h:panelGroup>
                                            </e5ui:column>

                                        </e5ui:dataTable>
                                    </div>
                                </div>

                                <div>
                                    <h:commandLink
                                            onclick="additionalResultsModal.clickOpen('additionalResultsModal'); return false;">
                                        Дополнительные исследования
                                    </h:commandLink>
                                </div>

                                <e5ui-comp:modalWindow id="additionalResultsModal"
                                                       modalWindowHolder="#{applicationSetup.additionalResultsModal}"
                                                       style="min-width:600px;" showButtons="false"
                                                       widgetVar="additionalResultsModal">
                                    <div id="title">Дополнительные результаты анализов</div>
                                    <div id="modal_container" style="margin-top: 0;">
                                        <div class="wrap" style="height:300px;">
                                            <div class="inner" style="height:300px;">
                                                <e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
                                                                value="#{bloodDonation.document.additionalResults}"
                                                                style="width:100%;" var="row" grouping="false">
                                                    <e5ui:column style="min-width:3em;">
                                                        <f:facet name="header">
                                                            <p>Код</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.indicatorCode}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:6em;">
                                                        <f:facet name="header">
                                                            <p>Название</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.indicatorName}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:4em;">
                                                        <f:facet name="header">
                                                            <p>Прибор</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.deviceName}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:4em;">
                                                        <f:facet name="header">
                                                            <p>Значение</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.resultValueText}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:4em;">
                                                        <f:facet name="header">
                                                            <p>Ед. изм.</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.resultUnit}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:4em;">
                                                        <f:facet name="header">
                                                            <p>Норма</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.resultNormString}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:4em;">
                                                        <f:facet name="header">
                                                            <p>Выполнено</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.resultSignDate}">
                                                            <f:convertDateTime type="date" pattern="dd.MM.yyyy HH:mm"/>
                                                        </h:outputText>
                                                    </e5ui:column>
                                                </e5ui:dataTable>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="e5ui-modal-bottombuttons">
                                        <h:button onclick="additionalResultsModal.clickClose(); return false;"
                                                  value="Закрыть"/>
                                    </div>
                                </e5ui-comp:modalWindow>

                                <e5ui-comp:modalWindow id="analysisValueListModal"
                                                       modalWindowHolder="#{applicationSetup.analysisValueListModal}"
                                                       render=":main_content_form"
                                                       execute="analysis_edit_table" style="width:600px;"
                                                       showButtons="false"
                                                       widgetVar="analysisValueListModal">
                                    <div id="title">Результаты исследований -
                                        <h:outputText
                                                value="#{applicationSetup.analysisValueListModal.analysis.type.value}"/>
                                    </div>
                                    <div id="modal_container" style="margin-top: 0;">
                                        <div class="wrap" style="height:300px;">
                                            <div class="inner" style="height:300px;">
                                                <e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
                                                                value="#{applicationSetup.analysisValueListModal.analysis.externalValues}"
                                                                id="analysis_edit_table" style="width:100%;" var="row"
                                                                grouping="false">
                                                    <e5ui:column style="min-width:3em;">
                                                        <f:facet name="header">
                                                            <p>Код</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.indicator.code}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:6em;">
                                                        <f:facet name="header">
                                                            <p>Название</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.indicator.name}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:6em;">
                                                        <f:facet name="header">
                                                            <p>Результат</p>
                                                        </f:facet>
                                                        <h:panelGroup
                                                                rendered="#{((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState}">
                                                            <h:inputText class="wide" value="#{row.value}">
                                                                <f:ajax/>
                                                            </h:inputText>
                                                        </h:panelGroup>
                                                        <h:panelGroup
                                                                rendered="#{not (((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState)}">
                                                            <h:outputText value="#{row.value}" class="wide"/>
                                                        </h:panelGroup>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:5em;">
                                                        <f:facet name="header">
                                                            <p>Ед. измерения</p>
                                                        </f:facet>
                                                        <h:panelGroup
                                                                rendered="#{((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState}">
                                                            <h:inputText value="#{row.unit}" size="3">
                                                                <f:ajax/>
                                                            </h:inputText>
                                                        </h:panelGroup>
                                                        <h:panelGroup
                                                                rendered="#{not (((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState)}">
                                                            <h:outputText value="#{row.unit}"/>
                                                        </h:panelGroup>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:4em;">
                                                        <f:facet name="header">
                                                            <p>Норма</p>
                                                        </f:facet>
                                                        <h:panelGroup
                                                                rendered="#{((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState}">
                                                            <h:inputText value="#{row.normValue}" size="3">
                                                                <f:ajax/>
                                                            </h:inputText>
                                                        </h:panelGroup>
                                                        <h:panelGroup
                                                                rendered="#{not (((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState)}">
                                                            <h:outputText value="#{row.normValue}"/>
                                                        </h:panelGroup>
                                                    </e5ui:column>
                                                </e5ui:dataTable>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="e5ui-modal-bottombuttons">
                                        <h:button onclick="analysisValueListModal.clickSave(); return false;"
                                                  value="ОК"/>
                                        <h:button onclick="analysisValueListModal.clickClose(); return false;"
                                                  value="Отмена"/>
                                    </div>
                                </e5ui-comp:modalWindow>
                            </fieldset>
                        </div>
                        <div>
                            <fieldset>
                                <legend>
                                    <label><span class="title">Иммуносерология</span> </label>
                                </legend>
                                <div class="wrap">
                                    <div class="inner">
                                        <e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
                                                        value="#{bloodDonation.document.testImmunoList}"
                                                        var="row" grouping="false">
                                            <e5ui:column style="width:220px;">
                                                <f:facet name="header">
                                                    <p>Фенотип</p>
                                                </f:facet>
                                                <h:outputText value="#{row.type.value}"/>
                                            </e5ui:column>
                                            <e5ui:column>
                                                <f:facet name="header">
                                                    <p>Результат</p>
                                                </f:facet>
                                                <strong>
                                                    <h:panelGroup
                                                            rendered="#{((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState}">
                                                        <h:panelGroup rendered="#{row.type.fieldType eq 0}">
                                                            <h:inputText class="wide" value="#{row.value}"/>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{row.type.fieldType eq 3}">
                                                            <h:selectOneMenu value="#{row.value}">
                                                                <f:selectItems
                                                                        value="#{dictionaryManagement.getValuesByCategory(row.type.value)}"/>
                                                            </h:selectOneMenu>
                                                        </h:panelGroup>
                                                        <h:panelGroup rendered="#{row.type.fieldType eq 4}">
                                                            <h:selectOneRadio layout="lineDirection"
                                                                              value="#{row.value}">
                                                                <f:selectItems
                                                                        value="#{dictionaryManagement.getValuesByCategory(row.type.value)}"/>
                                                            </h:selectOneRadio>
                                                        </h:panelGroup>
                                                    </h:panelGroup>
                                                </strong>
                                                <h:panelGroup
                                                        rendered="#{not (((bloodDonation.document.statusId eq 21) or (bloodDonation.document.statusId eq 3)) and bloodDonation.editState)}">
                                                    <h:outputText value="#{row.value}" style="font-weight:bold;"
                                                                  class="wide"/>
                                                </h:panelGroup>
                                            </e5ui:column>
                                        </e5ui:dataTable>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </h:panelGroup>
                    <h:panelGroup id="pheresis_report" rendered="#{not (bloodDonation.document.report eq null)}">
                        <div>
                            <fieldset>
                                <legend>
                                    <label><span class="title">Протокол цитафереза</span></label>
                                </legend>
                                <h:panelGroup
                                        rendered="#{bloodDonation.viewState or not ((bloodDonation.document.statusId eq 2) and sessionManagement.operational)}">
                                    <div class="row">
                                        <table class="form_grid">
                                            <tr class="row">
                                                <td class="first">Время завершения сеанса:</td>
                                                <td>
                                                    <h:outputText value="#{bloodDonation.document.report.endTime}">
                                                        <f:convertDateTime type="date" pattern="HH:mm:ss"/>
                                                    </h:outputText>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">Длительность сеанса, мин:</td>
                                                <td>
                                                    <h:outputText value="#{bloodDonation.document.report.time}"
                                                                  class="wide"/>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first"><strong>Общий объем обработанной крови, мл:</strong></td>
                                                <td>
                                                    <h:outputText value="#{bloodDonation.document.report.totalVolume}"/>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">Общий объем использованного АК, мл:</td>
                                                <td>
                                                    <h:outputText
                                                            value="#{bloodDonation.document.report.totalAcVolume}"/>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">Объем АК, поступивший донору, мл:</td>
                                                <td>
                                                    <h:outputText
                                                            value="#{bloodDonation.document.report.recievedAcVolume}"/>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">
                                                    <h:outputText
                                                            value="#{bloodDonation.granulocytePheresis? 'Общий объем WBC-конц. мл:': 'Общий объем PLT-конц. мл:'}"/>
                                                </td>
                                                <td>
                                                    <h:outputText
                                                            value="#{bloodDonation.document.report.totalPltVolume}"/>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">
                                                    <h:outputText
                                                            value="#{bloodDonation.granulocytePheresis? 'Объем АК в WBC-конц. мл:': 'Объем АК в PLT-конц. мл:'}"/>
                                                </td>
                                                <td>
                                                    <h:outputText value="#{bloodDonation.document.report.acPltVolume}"/>
                                                </td>
                                            </tr>
                                            <h:panelGroup rendered="#{not(bloodDonation.granulocytePheresis)}">
                                                <tr class="row">
                                                    <td class="first">Кол-во собр. PLT(х10<span
                                                            style="vertical-align:super;">11</span>):
                                                    </td>
                                                    <td>
                                                        <h:outputText
                                                                value="#{bloodDonation.document.report.collectedPlt}"/>
                                                    </td>
                                                </tr>
                                            </h:panelGroup>
                                            <tr class="row">
                                                <td class="first">
                                                    <h:outputText
                                                            value="#{bloodDonation.granulocytePheresis? 'Лабораторноизмеренный выход WBC:': 'Лабораторноизмеренный выход PLT:'}"/>
                                                </td>
                                                <td>
                                                    <h:outputText
                                                            value="#{bloodDonation.document.report.labPltVolume}"/>
                                                </td>
                                            </tr>
                                            <h:panelGroup rendered="#{bloodDonation.granulocytePheresis}">
                                                <tr class="row">
                                                    <td class="first">PMN, %:</td>
                                                    <td>
                                                        <h:outputText value="#{bloodDonation.document.report.pmn}"/>
                                                    </td>
                                                </tr>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{not(bloodDonation.granulocytePheresis)}">
                                                <tr class="row">
                                                    <td class="first">Соотношение лабораторно-отчет по PLT:</td>
                                                    <td>
                                                        <h:outputText
                                                                value="#{bloodDonation.document.report.correlationPlt}"/>
                                                    </td>
                                                </tr>
                                                <tr class="row">
                                                    <td class="first">Кол-во PLT донора после процедуры:</td>
                                                    <td>
                                                        <h:outputText
                                                                value="#{bloodDonation.document.report.donorPltAfter}"/>
                                                    </td>
                                                </tr>
                                            </h:panelGroup>
                                            <tr class="row">
                                                <td class="first">Ht донора до процедуры, %:</td>
                                                <td>
                                                    <h:outputText
                                                            value="#{bloodDonation.document.report.donorHtBefore}"/>
                                                </td>
                                            </tr>
                                            <h:panelGroup rendered="#{not(bloodDonation.granulocytePheresis)}">
                                                <tr class="row">
                                                    <td class="first">Ht донора после процедуры, %:</td>
                                                    <td>
                                                        <h:outputText
                                                                value="#{bloodDonation.document.report.donorHtAfter}"/>
                                                    </td>
                                                </tr>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{bloodDonation.granulocytePheresis}">
                                                <tr class="row">
                                                    <td class="first">Доза Г-КСФ, мкг:</td>
                                                    <td>
                                                        <h:outputText value="#{bloodDonation.document.report.gcsf}"/>
                                                    </td>
                                                </tr>
                                            </h:panelGroup>
                                            <tr class="row">
                                                <td class="first" colspan="2">
                                                    <fieldset>
                                                        <legend>
                                                            <label><span class="title">Плазма</span></label>
                                                        </legend>
                                                        <div class="row">
                                                            <table class="form_grid">
                                                                <tr class="row">
                                                                    <td class="first">Объем собранной плазмы, мл:</td>
                                                                    <td>
                                                                        <h:outputText
                                                                                value="#{bloodDonation.document.report.plasmaVolume}"/>
                                                                    </td>
                                                                </tr>
                                                                <tr class="row">
                                                                    <td class="first">Объем АК в плазме, мл:</td>
                                                                    <td>
                                                                        <h:outputText
                                                                                value="#{bloodDonation.document.report.acPlasmaVolume}"/>
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </div>
                                                    </fieldset>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first" colspan="2">
                                                    <fieldset>
                                                        <legend>
                                                            <label><span class="title">Эр.масса</span></label>
                                                        </legend>
                                                        <div class="row">
                                                            <table class="form_grid">
                                                                <tr class="row">
                                                                    <td class="first">Объем собранной эр.массы, мл:</td>
                                                                    <td>
                                                                        <h:outputText
                                                                                value="#{bloodDonation.document.report.erVolume}"/>
                                                                    </td>
                                                                </tr>
                                                                <tr class="row">
                                                                    <td class="first">Объем АК в эр.массе, мл:</td>
                                                                    <td>
                                                                        <h:outputText
                                                                                value="#{bloodDonation.document.report.acErVolume}"/>
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </div>
                                                    </fieldset>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">Примечание:</td>
                                                <td>
                                                    <h:outputText value="#{bloodDonation.document.report.commentary}"
                                                                  class="wide"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </h:panelGroup>
                                <h:panelGroup
                                        rendered="#{bloodDonation.editState and (bloodDonation.document.statusId eq 2) and sessionManagement.operational}">
                                    <div class="row">
                                        <table class="form_grid">
                                            <tr class="row">
                                                <td class="first">Время завершения сеанса:</td>
                                                <td>
                                                    <e5ui-comp:inputTime
                                                            value="#{bloodDonation.document.report.endTime}" lang="ru"/>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">Длительность сеанса, мин:</td>
                                                <td>
                                                    <h:inputText value="#{bloodDonation.document.report.time}"/>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first"><strong>Общий объем обработанной крови, мл:</strong></td>
                                                <td>
                                                    <h:inputText value="#{bloodDonation.document.report.totalVolume}"/>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">Общий объем использованного АК, мл:</td>
                                                <td>
                                                    <h:inputText
                                                            value="#{bloodDonation.document.report.totalAcVolume}"/>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">Объем АК, поступивший донору, мл:</td>
                                                <td>
                                                    <h:inputText
                                                            value="#{bloodDonation.document.report.recievedAcVolume}"/>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">
                                                    <h:outputText
                                                            value="#{bloodDonation.granulocytePheresis? 'Общий объем WBC-конц. мл:': 'Общий объем PLT-конц. мл:'}"/>
                                                </td>
                                                <td>
                                                    <h:inputText
                                                            value="#{bloodDonation.document.report.totalPltVolume}"/>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">
                                                    <h:outputText
                                                            value="#{bloodDonation.granulocytePheresis? 'Объем АК в WBC-конц. мл:': 'Объем АК в PLT-конц. мл:'}"/>
                                                </td>
                                                <td>
                                                    <h:inputText value="#{bloodDonation.document.report.acPltVolume}"/>
                                                </td>
                                            </tr>
                                            <h:panelGroup rendered="#{not(bloodDonation.granulocytePheresis)}">
                                                <tr class="row">
                                                    <td class="first">Кол-во собр. PLT(х10<span
                                                            style="vertical-align:super;">11</span>):
                                                    </td>
                                                    <td>
                                                        <h:inputText
                                                                value="#{bloodDonation.document.report.collectedPlt}"/>
                                                    </td>
                                                </tr>
                                            </h:panelGroup>
                                            <tr class="row">
                                                <td class="first">
                                                    <h:outputText
                                                            value="#{bloodDonation.granulocytePheresis? 'Лабораторноизмеренный выход WBC:': 'Лабораторноизмеренный выход PLT:'}"/>
                                                </td>
                                                <td>
                                                    <h:inputText value="#{bloodDonation.document.report.labPltVolume}"/>
                                                </td>
                                            </tr>
                                            <h:panelGroup rendered="#{bloodDonation.granulocytePheresis}">
                                                <tr class="row">
                                                    <td class="first">PMN, %:</td>
                                                    <td>
                                                        <h:inputText value="#{bloodDonation.document.report.pmn}"/>
                                                    </td>
                                                </tr>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{not(bloodDonation.granulocytePheresis)}">
                                                <tr class="row">
                                                    <td class="first">Соотношение лабораторно-отчет по PLT:</td>
                                                    <td>
                                                        <h:inputText
                                                                value="#{bloodDonation.document.report.correlationPlt}"/>
                                                    </td>
                                                </tr>
                                                <tr class="row">
                                                    <td class="first">Кол-во PLT донора после процедуры:</td>
                                                    <td>
                                                        <h:inputText
                                                                value="#{bloodDonation.document.report.donorPltAfter}"/>
                                                    </td>
                                                </tr>
                                            </h:panelGroup>
                                            <tr class="row">
                                                <td class="first">Ht донора до процедуры, %:</td>
                                                <td>
                                                    <h:inputText
                                                            value="#{bloodDonation.document.report.donorHtBefore}"/>
                                                </td>
                                            </tr>
                                            <h:panelGroup rendered="#{not(bloodDonation.granulocytePheresis)}">
                                                <tr class="row">
                                                    <td class="first">Ht донора после процедуры, %:</td>
                                                    <td>
                                                        <h:inputText
                                                                value="#{bloodDonation.document.report.donorHtAfter}"/>
                                                    </td>
                                                </tr>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{bloodDonation.granulocytePheresis}">
                                                <tr class="row">
                                                    <td class="first">Доза Г-КСФ, мкг:</td>
                                                    <td>
                                                        <h:inputText value="#{bloodDonation.document.report.gcsf}"/>
                                                    </td>
                                                </tr>
                                            </h:panelGroup>
                                            <tr class="row">
                                                <td class="first" colspan="2">
                                                    <fieldset>
                                                        <legend>
                                                            <label><span class="title">Плазма</span></label>
                                                        </legend>
                                                        <div class="row">
                                                            <table class="form_grid">
                                                                <tr class="row">
                                                                    <td class="first">Объем собранной плазмы, мл:</td>
                                                                    <td>
                                                                        <h:inputText
                                                                                value="#{bloodDonation.document.report.plasmaVolume}"/>
                                                                    </td>
                                                                </tr>
                                                                <tr class="row">
                                                                    <td class="first">Объем АК в плазме, мл:</td>
                                                                    <td>
                                                                        <h:inputText
                                                                                value="#{bloodDonation.document.report.acPlasmaVolume}"/>
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </div>
                                                    </fieldset>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first" colspan="2">
                                                    <fieldset>
                                                        <legend>
                                                            <label><span class="title">Эр.масса</span></label>
                                                        </legend>
                                                        <div class="row">
                                                            <table class="form_grid">
                                                                <tr class="row">
                                                                    <td class="first">Объем собранной эр.массы, мл:</td>
                                                                    <td>
                                                                        <h:inputText
                                                                                value="#{bloodDonation.document.report.erVolume}"/>
                                                                    </td>
                                                                </tr>
                                                                <tr class="row">
                                                                    <td class="first">Объем АК в эр.массе, мл:</td>
                                                                    <td>
                                                                        <h:inputText
                                                                                value="#{bloodDonation.document.report.acErVolume}"/>
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        </div>
                                                    </fieldset>
                                                </td>
                                            </tr>
                                            <tr class="row">
                                                <td class="first">Примечание:</td>
                                                <td>
                                                    <h:inputText value="#{bloodDonation.document.report.commentary}"
                                                                 class="wide"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </h:panelGroup>
                            </fieldset>
                        </div>
                    </h:panelGroup>
                </div>
            </h:panelGroup>
        </div>
    </ui:define>

    <ui:define name="footer">
        <e5ui-comp:splashScreen id="splash_screen" timeout="0">
            <f:facet name="timeoutPanel">
                <div style="background-color: white; border-top: solid 1px black; border-bottom: solid 1px black; padding: 30px; text-align: center; margin: 200px auto; width: 300px;">
                    Пожалуйста, подождите...
                </div>
            </f:facet>
        </e5ui-comp:splashScreen>
        <script>e5ui_splashScreen.startShowOnSubmit('splash_screen', ['main_content_form']);</script>
        <e5ui-comp:ajaxStatusGlobal timeout="300">
            <f:facet name="waitPanel">
                <div
                        style="background-color: white; border-top: solid 1px black; border-bottom: solid 1px black; padding: 30px; text-align: center; margin: 200px auto; width: 300px;">
                    Пожалуйста, подождите...
                </div>
            </f:facet>
        </e5ui-comp:ajaxStatusGlobal>

        <h:outputStylesheet library="css" name="datatable.css"/>
        <h:outputStylesheet library="css" name="modalWindow.css"/>
    </ui:define>

</ui:composition>
</html>