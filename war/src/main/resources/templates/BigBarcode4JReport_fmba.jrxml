<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.1.0.final using JasperReports Library version 6.1.0  -->
<!-- 2015-06-17T18:10:02 -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="BigBarcode4JReport_fmba" pageWidth="283" pageHeight="283" columnWidth="283" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="e2c27dca-4040-4067-8a42-4544c41dcfbc">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="NEW_DATAADAPTER.xml"/>
	<property name="com.jaspersoft.studio.unit." value="cm"/>
	<property name="com.jaspersoft.studio.unit.pageHeight" value="cm"/>
	<property name="com.jaspersoft.studio.unit.pageWidth" value="cm"/>
	<property name="com.jaspersoft.studio.unit.topMargin" value="cm"/>
	<property name="com.jaspersoft.studio.unit.bottomMargin" value="cm"/>
	<property name="com.jaspersoft.studio.unit.leftMargin" value="cm"/>
	<property name="com.jaspersoft.studio.unit.rightMargin" value="cm"/>
	<property name="com.jaspersoft.studio.unit.columnWidth" value="cm"/>
	<property name="com.jaspersoft.studio.unit.columnSpacing" value="cm"/>
	<style name="donorTextStyle" mode="Opaque" forecolor="#000000" backcolor="#FFFFFF">
		<conditionalStyle>
			<conditionExpression><![CDATA[$F{rhesusFactor}.toLowerCase().equals("отрицательный")]]></conditionExpression>
			<style forecolor="#FFFFFF" backcolor="#000000"/>
		</conditionalStyle>
	</style>
	<parameter name="docId" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
			DATE("2015-01-01") AS rr,
			comp.parentNumber AS donationNumber,
			comp.number AS componentNumber,
			comp.donorCode AS donorCode,
			compType.value AS componentType,
			comp.volume AS volume,
			450 AS donationVolume,
			1 AS donationType,
			anticoagulant.value AS anticoagulantType,
			comp.anticoagulantVolume AS anticoagulantVolume,
			resuspend.value AS resuspendType,
			comp.preservativeVolume AS resuspendVolume,
			comp.donationDate AS donationDate,
			comp.productionDate AS productionDate,
			comp.lowerStorageTemperature AS lowerStorageTemperature,
			comp.higherStorageTemperature AS higherStorageTemperature,
			comp.expirationDate AS expirationDate,
			rh.value AS rhesusFactor,
			bloodGroup.value AS bloodGroupValue,
			GROUP_CONCAT(CONCAT(IF(anal_req.value = 'K', '\n\tKell - ', anal_req.value),IF(anal_req.value= 'K', IF(req_tests.value = '+', '(Пол.)', '(Отр.)'),req_tests.value)) SEPARATOR '') as donationPhenotypes
			FROM trfu_blood_components comp
			INNER JOIN trfu_blood_component_types compType ON comp.componentType_id = compType.id
			LEFT JOIN trfu_anticoagulants anticoagulant ON comp.anticoagulant_id = anticoagulant.id
			LEFT JOIN trfu_classifiers resuspend ON resuspend.id = comp.preservative_id
			INNER JOIN trfu_classifiers rh ON rh.id = comp.rhesusFactor_id
			INNER JOIN trfu_blood_groups bloodGroup ON bloodGroup.id = comp.bloodGroup_id
			LEFT JOIN trfu_blood_component_tests bct ON comp.purchased AND comp.id = bct.component_id
			LEFT join trfu_tests req_tests on req_tests.id =  bct.test_id
			LEFT join trfu_analysis_types anal_req on anal_req.id=req_tests.type_id			
			where comp.id=$P{docId} and (anal_req.category="Иммуносерология" OR anal_req.category IS NULL)
			ORDER BY anal_req.id]]>
	</queryString>
	<field name="rr" class="java.util.Date"/>
	<field name="donationNumber" class="java.lang.String"/>
	<field name="componentNumber" class="java.lang.String"/>
	<field name="donorCode" class="java.lang.String"/>
	<field name="componentType" class="java.lang.String"/>
	<field name="volume" class="java.lang.Integer"/>
	<field name="donationVolume" class="java.lang.Integer"/>
	<field name="donationType" class="java.lang.Integer"/>
	<field name="anticoagulantType" class="java.lang.String"/>
	<field name="anticoagulantVolume" class="java.lang.Integer"/>
	<field name="resuspendType" class="java.lang.String"/>
	<field name="resuspendVolume" class="java.lang.Integer"/>
	<field name="donationDate" class="java.sql.Timestamp"/>
	<field name="productionDate" class="java.sql.Timestamp"/>
	<field name="lowerStorageTemperature" class="java.lang.Integer"/>
	<field name="higherStorageTemperature" class="java.lang.Integer"/>
	<field name="expirationDate" class="java.sql.Timestamp"/>
	<field name="rhesusFactor" class="java.lang.String"/>
	<field name="bloodGroupValue" class="java.lang.String"/>
	<field name="donationPhenotypes" class="java.lang.String"/>
	<variable name="resuspendInfo" class="java.lang.String" resetType="None">
		<variableExpression><![CDATA[$F{resuspendType} + " ("+ $F{resuspendVolume}+" мл)"]]></variableExpression>
	</variable>
	<variable name="anticoagulantInfo" class="java.lang.String" resetType="None">
		<variableExpression><![CDATA[$F{anticoagulantType} + " " + $F{anticoagulantVolume}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="25" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="cm"/>
			<staticText>
				<reportElement x="0" y="0" width="283" height="24" uuid="5a4e10c7-d94f-4ce8-aebb-6b6ce32b1048">
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font fontName="Tahoma" size="10"/>
				</textElement>
				<text><![CDATA[ФГБУЗ Центр крови ФМБА РФ]]></text>
			</staticText>
		</band>
	</title>
	<detail>
		<band height="252" splitType="Immediate">
			<line direction="BottomUp">
				<reportElement mode="Transparent" x="140" y="1" width="1" height="251" uuid="1f7a38a7-8cd0-49a6-a176-0b178c5b23fc">
					<property name="com.jaspersoft.studio.unit.width" value="cm"/>
				</reportElement>
			</line>
			<line>
				<reportElement x="0" y="91" width="283" height="1" uuid="22a375fa-1e59-4e88-b25b-98a6b4fd0c9d"/>
			</line>
			<staticText>
				<reportElement x="40" y="0" width="70" height="11" uuid="376a9a1a-a69f-455c-bda8-16a7b729b2f5">
					<property name="local_mesure_unitheight" value="pixel"/>
				</reportElement>
				<textElement textAlignment="Center">
					<font fontName="Tahoma" size="7" isBold="true"/>
				</textElement>
				<text><![CDATA[НОМЕР ДОНАЦИИ]]></text>
			</staticText>
			<textField>
				<reportElement x="0" y="11" width="50" height="14" uuid="8fe96003-1475-4b89-9e75-b79b2a377ec4">
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="local_mesure_unitwidth" value="cm"/>
				</reportElement>
				<textElement textAlignment="Right">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<textFieldExpression><![CDATA["7748"+DATEFORMAT($F{rr},"yy")]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="50" y="11" width="50" height="14" uuid="fb6d3d68-6bb0-43d1-9a0f-475ed80a1ada"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="10" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{donationNumber}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="100" y="10" width="22" height="17" uuid="a2799976-5100-4b42-b07b-8ee368b4a7f8">
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="local_mesure_unity" value="cm"/>
					<property name="com.jaspersoft.studio.unit.y" value="cm"/>
					<property name="com.jaspersoft.studio.unit.width" value="cm"/>
				</reportElement>
				<box topPadding="1" leftPadding="1" bottomPadding="1" rightPadding="1">
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center">
					<font fontName="Tahoma" size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{componentNumber}]]></textFieldExpression>
			</textField>
			<componentElement>
				<reportElement x="15" y="31" width="111" height="35" uuid="d41f69fb-f467-44f0-81fc-8139ef399d27">
					<property name="com.jaspersoft.studio.unit.y" value="cm"/>
					<property name="com.jaspersoft.studio.unit.width" value="cm"/>
				</reportElement>
				<jr:Code128 xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd" moduleWidth="1.0" textPosition="none">
					<jr:codeExpression><![CDATA["7748"+DATEFORMAT($F{rr},"yy")+$F{donationNumber}+$F{componentNumber}]]></jr:codeExpression>
				</jr:Code128>
			</componentElement>
			<textField>
				<reportElement x="10" y="62" width="120" height="11" uuid="7b1aa4c9-5778-4263-bf33-609afef8165a">
					<property name="com.jaspersoft.studio.unit.height" value="cm"/>
				</reportElement>
				<textElement textAlignment="Center">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<textFieldExpression><![CDATA["Код донора: "+($F{donorCode} != null ? $F{donorCode} : "")]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="0" y="176" width="141" height="1" uuid="f475fe40-289e-4958-8d8c-74073e118d11"/>
			</line>
			<textField>
				<reportElement x="0" y="92" width="138" height="68" uuid="b9707cfe-09eb-4513-be9d-dc1677213fea">
					<property name="com.jaspersoft.studio.unit.x" value="cm"/>
					<property name="com.jaspersoft.studio.unit.height" value="cm"/>
				</reportElement>
				<textElement textAlignment="Center">
					<font fontName="Tahoma" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{componentType}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="5" y="160" width="55" height="16" uuid="9e64aa70-cfd1-45c6-a8bb-61a97a3ca70a">
					<property name="com.jaspersoft.studio.unit.height" value="cm"/>
				</reportElement>
				<textElement verticalAlignment="Bottom" markup="none">
					<font fontName="Tahoma" size="11" isBold="true"/>
				</textElement>
				<text><![CDATA[Объем]]></text>
			</staticText>
			<textField>
				<reportElement x="60" y="160" width="75" height="16" uuid="89be0a4f-02da-4ef0-a767-ae9efed4627f"/>
				<textElement textAlignment="Right" verticalAlignment="Bottom">
					<font fontName="Tahoma" size="11" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[($F{volume} != null ? $F{volume}+" мл" : " ")]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="141" y="180" width="143" height="1" uuid="9a658e9f-3eb8-47ef-a6a0-f4d4b7fae334"/>
			</line>
			<staticText>
				<reportElement x="143" y="181" width="130" height="70" uuid="5e400287-5485-4ce2-899f-f716014ef7be"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" size="7"/>
				</textElement>
				<text><![CDATA[Перед переливанием:
  ٠  проверить группу крови больного
  ٠  проверить группу крови донора
  ٠  проверить на совместимость по группе крови и резус-фактору
  ٠  произвести биологическую пробу]]></text>
			</staticText>
			<staticText>
				<reportElement x="150" y="141" width="122" height="39" uuid="99ff28cd-ece5-40a0-8f87-811285b9f7e8"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Тесты на ВИЧ, 
гепатиты B и C, 
сифилис отрицательны]]></text>
			</staticText>
			<line>
				<reportElement x="141" y="141" width="141" height="1" uuid="0b11da94-d1ce-482d-9eda-ffa936fa3627"/>
			</line>
			<textField>
				<reportElement x="5" y="177" width="134" height="14" uuid="741ed2e9-4d09-49f6-b547-04ad6c54203e"/>
				<textElement verticalAlignment="Bottom">
					<font fontName="Tahoma" size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[($F{donationVolume} != null && $F{donationType} != null ? ("Из "+ $F{donationVolume}+ " мл " + ($F{donationType} == 1 ? "цельной": "переработанной") +" крови") : "")+($V{anticoagulantInfo} != null ? ", "+$V{anticoagulantInfo}+" мл.": "")]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="5" y="191" width="130" height="14" uuid="5933077a-a5c5-4e12-bb0e-ed0a0fcb63ee">
					<property name="com.jaspersoft.studio.unit.height" value="cm"/>
				</reportElement>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" size="7"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{resuspendInfo} != null ? $V{resuspendInfo} : ""]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="5" y="205" width="130" height="14" uuid="b3df836b-9e51-455a-9386-77f9252afd72"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" size="7"/>
				</textElement>
				<textFieldExpression><![CDATA["Дата донации " + DATEFORMAT($F{donationDate}, "dd.MM.yyyy")]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="5" y="219" width="130" height="22" uuid="508163b2-2b9d-4a07-943b-08dc5c69b644">
					<property name="com.jaspersoft.studio.unit.height" value="cm"/>
				</reportElement>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" size="7"/>
				</textElement>
				<textFieldExpression><![CDATA["Дата изготовления компонента\n"+new SimpleDateFormat("dd.MM.yyyy HH:mm").format($F{productionDate})]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="143" y="92" width="131" height="19" uuid="315f55f4-d666-4f13-82c7-1ad4437527a3"/>
				<textElement>
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA["Хранить при t от "+($F{lowerStorageTemperature} > 0 ? "+": "")+$F{lowerStorageTemperature}+"° до "+($F{higherStorageTemperature}> 0 ? "+": "")+ $F{higherStorageTemperature}+"° С"]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="143" y="111" width="131" height="20" uuid="fb4844f9-93cf-46bb-bf3c-a0f3dd43bb4a"/>
				<textElement>
					<font fontName="Tahoma" size="10"/>
				</textElement>
				<text><![CDATA[Облучено 25 Гр]]></text>
			</staticText>
			<textField>
				<reportElement x="143" y="73" width="138" height="18" uuid="ebb57ec7-fa36-4fb5-ad86-47c5d060dbf6">
					<property name="com.jaspersoft.studio.unit.x" value="cm"/>
				</reportElement>
				<textElement>
					<font fontName="Tahoma" size="10"/>
				</textElement>
				<textFieldExpression><![CDATA["Годен по "+($F{expirationDate} != null ? DATEFORMAT($F{expirationDate}, "dd.MM.yyyy HH:mm"): "")]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="donorTextStyle" x="141" y="1" width="140" height="30" uuid="4fe578fe-c8af-47f5-bbc7-2849bf78c021">
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="23"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{bloodGroupValue}.indexOf("(") > 0 ? $F{bloodGroupValue}.substring(0, $F{bloodGroupValue}.indexOf("(")): $F{bloodGroupValue}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="donorTextStyle" x="141" y="31" width="140" height="16" uuid="779f974c-7c76-4d78-80ca-0dd3740f01d5">
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Center">
					<font fontName="Tahoma" size="11"/>
				</textElement>
				<textFieldExpression><![CDATA["Rh"+($F{rhesusFactor}.contains("ж") ? "+ " : "- ") +LOWER($F{rhesusFactor})]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="140" y="72" width="142" height="1" uuid="e562d12d-1192-44cc-ac40-f2840a928b11"/>
			</line>
			<textField isBlankWhenNull="true">
				<reportElement style="donorTextStyle" x="141" y="46" width="140" height="26" uuid="ca0f8810-42af-4521-b74f-1c55e34ddf4e">
					<property name="local_mesure_unitheight" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Center">
					<font fontName="Tahoma" size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{donationPhenotypes}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="0" y="0" width="283" height="1" uuid="3da62c4f-95b6-4a91-9be0-1a1d4dba3250"/>
			</line>
		</band>
	</detail>
</jasperReport>
